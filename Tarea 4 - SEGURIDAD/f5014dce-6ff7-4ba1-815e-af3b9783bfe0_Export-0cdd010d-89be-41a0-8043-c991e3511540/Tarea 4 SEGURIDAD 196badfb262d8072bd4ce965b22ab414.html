<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Tarea 4: SEGURIDAD</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(248, 248, 247, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(248, 243, 252, 1);
}
.highlight-pink_background {
	background: rgba(252, 241, 246, 1);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(248, 248, 247, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(248, 243, 252, 1);
}
.block-color-pink_background {
	background: rgba(252, 241, 246, 1);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: undefined; }
.select-value-color-pink { background-color: rgba(225, 136, 179, 0.27); }
.select-value-color-purple { background-color: rgba(168, 129, 197, 0.27); }
.select-value-color-green { background-color: rgba(123, 183, 129, 0.27); }
.select-value-color-gray { background-color: rgba(84, 72, 49, 0.15); }
.select-value-color-transparentGray { background-color: undefined; }
.select-value-color-translucentGray { background-color: undefined; }
.select-value-color-orange { background-color: rgba(224, 124, 57, 0.27); }
.select-value-color-brown { background-color: rgba(210, 162, 141, 0.35); }
.select-value-color-red { background-color: rgba(244, 171, 159, 0.4); }
.select-value-color-yellow { background-color: rgba(236, 191, 66, 0.39); }
.select-value-color-blue { background-color: rgba(93, 165, 206, 0.27); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="196badfb-262d-8072-bd4c-e965b22ab414" class="page sans"><header><img class="page-cover-image" src="https://saludelectronica.com/wp-content/uploads/2022/07/Imagen4-1-1536x576.png" style="object-position:center 44.85%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">üë∑üèΩ‚Äç‚ôÇÔ∏è</span></div><h1 class="page-title">Tarea 4: SEGURIDAD</h1><p class="page-description"></p></header><div class="page-body"><nav id="196badfb-262d-80bc-a28b-e2f89f126d83" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#196badfb-262d-801a-b4cb-ee0312969425">1.- Encriptaci√≥n</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#196badfb-262d-80ca-ae44-d511c4a80f5d">Veracrypt</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#196badfb-262d-80e8-9a71-e828a5e905a1">Encriptaci√≥n de procedimientos</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#196badfb-262d-80a9-b6ec-f681d3749f57">Encriptaci√≥n de datos en SSMS</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1babadfb-262d-8040-832a-d0608fa1ccc4">Encriptaci√≥n de columnas</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1babadfb-262d-80c5-b60c-e85bec06923a">Ejemplo 2 (encriptaci√≥n columnas)</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1babadfb-262d-80f9-b295-e0fa8dfb542e">Encriptar usando frase</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1babadfb-262d-8070-9f47-d36574c94bf6">Encriptaci√≥n de Backups</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1bbbadfb-262d-806c-9f8d-e928371e39d4">Encriptaci√≥n de TDE (Transparent data encryption)</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1bbbadfb-262d-80a8-950d-f0abe64a181a">Hashing</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bbbadfb-262d-80cf-b00e-eea0d76da940">DDM Dynamic Data Masking</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bbbadfb-262d-8084-a110-ec9cc71aa608">Secuencias</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bbbadfb-262d-80f3-9110-c92f2aae55dc">ROW LEVEL SECURITY (RLS)</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1bbbadfb-262d-800c-895c-c504f5c19a67">Otro ejemplo de RLS</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bcbadfb-262d-8027-963a-de10e3e6184f">Always Encrypted</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1bcbadfb-262d-8044-995b-d649d0a72635">2.- Auditor√≠as</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bcbadfb-262d-8017-81a0-dc75b24aee42">Auditor√≠a de servidor</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1bcbadfb-262d-803f-a672-e87e2dbbb6c9">Desde el interfaz gr√°fico:</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#1bcbadfb-262d-8026-b377-d2404b5901af">Desde el script</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bcbadfb-262d-80ec-91e5-ed99d38617b0">Audiror√≠a de base de datos</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1bcbadfb-262d-805e-adac-f9fdb86de334">3.- LEDGER</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bcbadfb-262d-80c3-8aa1-caef8834f4af"><strong>Updatable Ledger Table </strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bdbadfb-262d-80a6-859b-ea767fed6ace"><strong>Append-only Ledger Table</strong> </a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1bdbadfb-262d-80ed-bc82-dc3ba9905737">Prueba detecci√≥n de modificaciones</a></div></nav><h1 id="196badfb-262d-801a-b4cb-ee0312969425" class="">1.- Encriptaci√≥n</h1><p id="196badfb-262d-8034-b3ba-ee93c9cad508" class="">La <strong>encriptaci√≥n</strong> (o mejor dicho, <strong>cifrado</strong>) es el proceso de convertir informaci√≥n en un formato ilegible para que solo personas autorizadas puedan acceder a ella. Se utiliza para proteger datos y garantizar su confidencialidad.</p><p id="196badfb-262d-80b1-a5ad-c32cfa36d88a" class="">En nuestro caso, lo que realmente nos interesa es que nadie pueda acceder a nuestra informaci√≥n, ya sea desde dentro de las bases de datos o bien desde fuera, mediante acceso a las mismas o mediante acceso a la informaci√≥n en circulaci√≥n, capturando esta con sniffers. Para ello, el propio Windows trae un sotware de encriptaci√≥n llamado Bitlocker. Para este ejercicio, nosotros hemos decidido usar Veracrypt que viene a ser lo mismo pero externo y de c√≥digo abierto.</p><h3 id="196badfb-262d-80ca-ae44-d511c4a80f5d" class="">Veracrypt</h3><p id="196badfb-262d-8085-a971-de6610f61b17" class="">VeraCrypt es un software de <strong>cifrado de datos</strong> que permite crear vol√∫menes cifrados para proteger archivos y discos completos. Es un sucesor mejorado de <strong>TrueCrypt</strong>, dise√±ado para proporcionar mayor seguridad y resistencia contra ataques de fuerza bruta. Es √∫til para proteger informaci√≥n confidencial en entornos personales y profesionales, sobre todo en el √°mbito de la <strong>ciberseguridad</strong>, donde la privacidad y la integridad de los datos son cr√≠ticas. </p><p id="196badfb-262d-8015-b9f7-efa9127816db" class="">Nos permitir√° guardar bases de datos completas o copias de seguridad de las mismas.</p><p id="196badfb-262d-8003-b6dd-d164c4134cde" class="">Lo primero que haremos ser√° acceder a la web oficial de Veracrypt para descargar el software, como podemos ver, tenemos el software disponible para las plataformas mas usadas. Lo descargamos (en nuestro caso para Windows) y lo instalamos, no hacemos referencia a la instalaci√≥n puesto que tan solo tendremos que presionar ‚Äúsiguiente‚Äù y dejar que la instalaci√≥n finalice.</p><p id="196badfb-262d-80a7-b8b4-d6caae1361b2" class=""><a href="https://www.veracrypt.fr/en/Downloads.html">https://www.veracrypt.fr/en/Downloads.html</a></p><figure id="196badfb-262d-8078-9fe2-c30d27945b55" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.16.58.png"><img style="width:709.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.16.58.png"/></a></figure><p id="196badfb-262d-8089-ac07-d2533ced3049" class="">
</p><p id="196badfb-262d-8027-a25a-ef18f680b8e7" class="">Al abrir el software nos encontramos con la siguiente ventana, tendremos que escoger una letra de unidad y luego presionar en ‚ÄúCreate Volume‚Äù.</p><figure id="196badfb-262d-8078-8909-e8dade7d4c31" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.24.16.png"><img style="width:553px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.24.16.png"/></a></figure><p id="196badfb-262d-803b-84f0-ddcaa549b8dc" class="">
</p><p id="196badfb-262d-80ae-a684-fd715b72382a" class="">Se nos mostrar√°n tres opciones, una para crear y encriptar un archivo contenedor, otra para encriptar un driver intero o externo (disco duro entero) y otra opci√≥n para encriptar particiones enteras o sistemas operativos. Escogemos la primera opci√≥n.</p><figure id="196badfb-262d-80d4-96fc-f5fccfaba09f" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.24.54.png"><img style="width:662px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.24.54.png"/></a></figure><p id="196badfb-262d-8088-9a9d-d92a50252d09" class="">
</p><p id="196badfb-262d-8089-8e37-d33187cbdee9" class="">Nos mostrar√° un warning advirti√©ndonos de que vamos a crear un volumen y que si no tenemos privilegios de administrador, puede que luego no podamos acceder a dicho volumen. Presionamos en ‚ÄúNo‚Äù.</p><figure id="196badfb-262d-809f-b076-d4babf732514" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.25.07.png"><img style="width:659px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.25.07.png"/></a></figure><p id="196badfb-262d-809b-9941-fecb23c8080a" class="">
</p><p id="196badfb-262d-809d-92d9-de1b8b847fbd" class="">Ahora se nos mostrar√°n dos opciones, la primera una encriptaci√≥n normal y la segunda una encriptaci√≥n doble para que dependiendo de la contrase√±a que se introduzca al desencriptar, se muestren unos archivos u otros. Seleccionamos la primera opci√≥n.</p><figure id="196badfb-262d-80ce-baa8-d59bb311429f" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.31.14.png"><img style="width:661px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.31.14.png"/></a></figure><p id="196badfb-262d-8060-876d-d438a5c6dd28" class="">
</p><p id="196badfb-262d-80cb-9a3f-ec64dcfbd2de" class="">Ahora seleccionamos el directorio del archivo donde se va a guardar la informaci√≥n encriptada.</p><figure id="196badfb-262d-80db-9ebb-ca3e63160407" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.35.17.png"><img style="width:664px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.35.17.png"/></a></figure><p id="196badfb-262d-80b6-b847-def7c636fcf0" class="">
</p><p id="196badfb-262d-80bd-ab32-c6786e17940a" class="">En el siguiente paso seleccionaremos el m√©todo de encriptaci√≥n, en este caso dejaremos las opciones tal cual est√°n ya que AES y 512 es mas que suficiente para dar seguridad a los archivos.</p><figure id="196badfb-262d-8076-80cf-ebbaeaeded18" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.35.29.png"><img style="width:662px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.35.29.png"/></a></figure><p id="196badfb-262d-8039-87dc-e8adcc47ef84" class="">
</p><p id="196badfb-262d-8043-ab71-ce3a52b8087a" class="">Por √∫ltimo, escogeremos el tama√±o que le queremos dar al volumen encriptado, debemos tener en cuenta que nuestros archivos podr√°n crecer de tama√±o, por este motivo debemos crear el volumen con algo de margen dependiendo de lo que queramos encriptar. En este caso como vamos a usar archivos peque√±os, crearemos un volumen de 100Mb.</p><figure id="196badfb-262d-808c-9777-fd5a49e83e1e" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.44.44.png"><img style="width:665px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.44.44.png"/></a></figure><p id="196badfb-262d-8054-90c0-d87a8118c167" class="">
</p><p id="196badfb-262d-8052-af66-d4a616d0dc25" class="">A√±adimos un password, hemos puesto la que venimos usando en todas las contrase√±as desde principio de curso ‚ÄòAbcd1234.‚Äô Aunque nos mostrar√° un warning diciendo que la contrase√±a es demasiado corta para ser segura, presionamos continuar.</p><figure id="196badfb-262d-80ef-88b6-e9249b6daca6" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.41.12.png"><img style="width:663px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.41.12.png"/></a></figure><p id="196badfb-262d-80a3-a8f4-de9e226428fc" class="">
</p><p id="196badfb-262d-80ce-b947-dc1cbb6a428b" class="">Ahora se encriptar√° el volumen, debemos tener en cuenta que cuanto mayor tama√±o tenga el volumen, mas tiempo tardar√° en encriptarse. Debemos mover el rat√≥n continuamente hasta que se llene la barra inferior. Una vez termine presionaremos en ‚ÄúFormat‚Äù.</p><figure id="196badfb-262d-804a-b193-f6832c5048aa" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.42.33.png"><img style="width:663px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.42.33.png"/></a></figure><p id="196badfb-262d-80c8-9543-ccf01cf4e029" class="">
</p><figure id="196badfb-262d-8039-acf5-dc072fcad1a8" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.53.58.png"><img style="width:662px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.53.58.png"/></a></figure><p id="196badfb-262d-801c-8121-ccbc0cf2b8d9" class="">
</p><p id="196badfb-262d-8066-9f5e-e92a6cdd71c4" class="">Ahora tendremos nuestro volumen encriptado en la ubicaci√≥n que hemos designado, como podemos ver, se trata de un archivo sin extensi√≥n que no podremos abrir. Para abrirlo, usaremos de nuevo el software de Veracrypt. Entramos y esta vez seleccionamos el archivo y presionaremos en ‚Äúmount‚Äù, nos pedir√° la contrase√±a que hemos configurado.</p><figure id="196badfb-262d-8008-9e15-d2c572b2ddb4" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.56.18.png"><img style="width:552px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.56.18.png"/></a></figure><p id="196badfb-262d-80f4-b80a-c767cf382c3c" class="">
</p><p id="196badfb-262d-80db-bddc-d6321ab7bcf7" class="">Como podemos ver, se ha creado una unidad del tama√±o que hemos designado, ahora bastar√° con soltar dentro de la unidad los archoivos que queremos encriptar y luego, desde el software de Veracrypt presionar en Unmount para desmontar y que el archivo quede encriptado.</p><figure id="196badfb-262d-806f-817c-e8f05a53cc91" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.57.58.png"><img style="width:709.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_16.57.58.png"/></a></figure><p id="196badfb-262d-8056-9f2a-d2a6bb87c727" class="">
</p><h2 id="196badfb-262d-80e8-9a71-e828a5e905a1" class="">Encriptaci√≥n de procedimientos</h2><p id="196badfb-262d-8038-bb12-e35bcb8e785f" class="">Encriptar un procedimiento es algo tan sencillo como a√±adir ‚ÄúWITH ENCRYPTION‚Äù al c√≥digo del mismo. De esta forma, nadie podr√° ver el contenido del mismo. Vamos a generar un procedimiento que al introducir una matr√≠cula, se elimine la misma de la base de datos de nuestra autoescuela si existiese y de lo contrario muestre un error (aunque en este caso no tiene mucho sentido encriptar el procedimiento, podr√≠a interesarnos que nos e supiese, por ejemplo, el m√©todo que usamos para subir el sueldo a los empleados o la f√≥rmula con la que un procedimiento calcula la productividad de un empleado).</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="196badfb-262d-806c-a65a-eb28544bf564" class="code"><code class="language-SQL">CREATE PROCEDURE sp_EliminarVehiculo  
    @Matricula NVARCHAR(10)  
WITH ENCRYPTION  -- Con encriptaci√≥n
AS  
BEGIN  
    SET NOCOUNT ON;  
    -- Verificar si la matr√≠cula existe en la tabla
    IF EXISTS (SELECT 1 FROM vehiculo WHERE Matricula_vehiculo = @Matricula)  
    BEGIN  
        DELETE FROM vehiculo WHERE Matricula_vehiculo = @Matricula;  
        PRINT &#x27;El veh√≠culo con matr√≠cula &#x27; + @Matricula + &#x27; ha sido eliminado correctamente.&#x27;;  
    END  
    ELSE  
    BEGIN  
        PRINT &#x27;La matr√≠cula introducida no existe en la base de datos.&#x27;;  
    END  
END;</code></pre><p id="196badfb-262d-801d-a195-e4004d117680" class="">Ahora, si intentamos acceder al c√≥digo del mismo, comprobamos que se nos muestra un error.</p><figure id="196badfb-262d-8088-ae91-eb51e51edb83" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_17.37.54.png"><img style="width:515px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-02-10_a_las_17.37.54.png"/></a></figure><p id="196badfb-262d-80f4-9445-fa7eec49caa1" class="">
</p><p id="196badfb-262d-80d6-9d25-e8a329deb946" class="">
</p><h2 id="196badfb-262d-80a9-b6ec-f681d3749f57" class="">Encriptaci√≥n de datos en SSMS</h2><h3 id="1babadfb-262d-8040-832a-d0608fa1ccc4" class="">Encriptaci√≥n de columnas</h3><p id="196badfb-262d-8081-b76b-ef397acfc67c" class="">El sentido de encriptar una columnas no es m√°s que cifrar ciertos datos de una tabla que no queremos que se muestren a un determinado usuario o grupos de usuarios. (muy √∫til en la actualidad para la protecci√≥n de datos)</p><p id="196badfb-262d-802c-89c2-f2733cf667ce" class="">
</p><p id="196badfb-262d-806d-b447-d200566b21f8" class="">Necesitaremos realizar los siguientes paso:</p><ul id="1babadfb-262d-8083-afc1-d2ea04f30221" class="bulleted-list"><li style="list-style-type:disc">Crear una clave ‚Äúmaster key‚Äù</li></ul><ul id="1babadfb-262d-8077-8232-dd48dd8bc1a7" class="bulleted-list"><li style="list-style-type:disc"> Crear los certificados</li></ul><ul id="1babadfb-262d-800c-a31e-e5350313e090" class="bulleted-list"><li style="list-style-type:disc"> Crear la ‚ÄúSymmetric key‚Äù.</li></ul><p id="1babadfb-262d-80c4-b81e-e0cccfaca7ee" class="">En este ejemplo vamos a usar la encriptaci√≥n de columnas para que cada profesor de la autoescuela, solo pueda acceder a los datos de sus alumnos y no a los datos del resto de alumnos del centro.</p><p id="196badfb-262d-80d5-9c62-e71da4eea5b9" class="">Para crear la master key, usaremos:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="196badfb-262d-806b-9be2-db267a248af1" class="code"><code class="language-SQL">DROP MASTER KEY
GO
CREATE master KEY encryption BY password = &#x27;Abcd1234.&#x27;</code></pre><p id="1babadfb-262d-8086-a4cd-ce074278096f" class="">Comprobamos que la hemos creado correctamentre:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-808b-88a2-f1721c60cd8b" class="code"><code class="language-SQL">SELECT name KeyName,
	symmetric_key_id KeyID,
	key_length KeyLength,
	algorithm_desc KeyAlgorithm
FROM sys.symmetric_keys;
GO</code></pre><figure id="1babadfb-262d-8004-bda2-dcde39506459" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_18.02.48.png"><img style="width:538px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_18.02.48.png"/></a></figure><p id="1babadfb-262d-8045-b27e-efcd110df777" class="">
</p><p id="1babadfb-262d-8078-9c2e-c3e01206828c" class="">Para crear el certificado usaremos:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-80a7-a65d-e71c6f9a5bbe" class="code"><code class="language-SQL">CREATE CERTIFICATE profe1cert AUTHORIZATION profe1
WITH subject = &#x27;Abcd1234.&#x27;, EXPIRY_DATE = &#x27;2025-12-31&#x27;;  
GO
CREATE CERTIFICATE profe2cert AUTHORIZATION profe2
WITH subject = &#x27;Abcd1234.&#x27;, EXPIRY_DATE = &#x27;2025-12-31&#x27;;
GO</code></pre><p id="1babadfb-262d-80d5-9792-d562aaca1b0b" class="">
</p><p id="197badfb-262d-8058-bbbb-e90e599ea83c" class="">Comprobamos que los hemos creado:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8056-aace-e29a9a1a8ca1" class="code"><code class="language-SQL">SELECT name CertName,
	certificate_id CertID,
	pvt_key_encryption_type_desc EncryptType,
	issuer_name Issuer
FROM sys.certificates;
GO</code></pre><figure id="1babadfb-262d-800a-9db7-ea98afc5a53c" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_18.04.49.png"><img style="width:529px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_18.04.49.png"/></a></figure><p id="1babadfb-262d-80f2-a24f-cddb59691e45" class="">
</p><p id="1babadfb-262d-80d8-a788-ce7cfd0cacb5" class="">Por √∫ltimo, ya solo nos queda crear la clave sim√©trica:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8069-91cf-f80063f56697" class="code"><code class="language-SQL">CREATE SYMMETRIC KEY SK_01
	WITH ALGORITHM = AES_256
	ENCRYPTION BY CERTIFICATE profe1cert;
	GO

CREATE SYMMETRIC KEY SK_02
	WITH ALGORITHM = AES_256
	ENCRYPTION BY CERTIFICATE profe2cert;
	GO</code></pre><figure id="1babadfb-262d-80f8-b108-d9f276676d19" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_18.06.07.png"><img style="width:566px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_18.06.07.png"/></a></figure><p id="1babadfb-262d-80a2-b632-fce184977df1" class="">
</p><p id="1babadfb-262d-80ff-b304-c5a26f4f6019" class="">Ahora vamos a realizar las pruebas, primero abriremos la clave sim√©trica para usarla</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-80b8-87f7-ef9442e01004" class="code"><code class="language-SQL">OPEN SYMMETRIC KEY SK_01
	DECRYPTION BY CERTIFICATE profe1cert
GO</code></pre><figure id="1babadfb-262d-80d9-9b9f-f85867045454" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_19.04.20.png"><img style="width:834.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_19.04.20.png"/></a></figure><p id="1babadfb-262d-8029-9fda-e8a9f563c718" class="">
</p><p id="1babadfb-262d-800c-ab9e-d4bc6a061212" class="">
</p><p id="1babadfb-262d-8047-accf-ddae488f4e6b" class="">Ahora insertamos datos en la tabla ‚Äúalumnos‚Äù encriptando tel√©fono y direcci√≥n con profe1:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8046-a968-ea66c4c3166f" class="code"><code class="language-SQL">INSERT INTO [autoescuelaP].[dbo].[alumnos] (
    [DNI_cliente],
    [N_cliente],
    [Apel1_cliente],
    [Apel2_cliente],
    [Dir_cliente],
    [Email_cliente],
    [Telf_cliente],
    [localidad_cod_localidad]
)
VALUES
(
    &#x27;12345678A&#x27;,  
    &#x27;Carlos&#x27;,
    &#x27;Garc√≠a&#x27;,
    &#x27;L√≥pez&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_01&#x27;), &#x27;Calle Gran V√≠a 123, Madrid&#x27;),  
    &#x27;carlos.garcia@mail.com&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_01&#x27;), &#x27;637345678&#x27;), 
    28001  
),
(
    &#x27;87654321B&#x27;,
    &#x27;Laura&#x27;,
    &#x27;Mart√≠nez&#x27;,
    &#x27;S√°nchez&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_01&#x27;), &#x27;Avenida Diagonal 456, Barcelona&#x27;),
    &#x27;laura.martinez@mail.com&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_01&#x27;), &#x27;633456789&#x27;),
    08001  
),
(
    &#x27;11223344C&#x27;,
    &#x27;Miguel&#x27;,
    &#x27;Fern√°ndez&#x27;,
    &#x27;Rodr√≠guez&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_01&#x27;), &#x27;Plaza del Ayuntamiento 7, Valencia&#x27;),
    &#x27;miguel.fernandez@mail.com&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_01&#x27;), &#x27;663123456&#x27;),
    46001  
);</code></pre><p id="1babadfb-262d-8075-8b28-ff64b038357e" class="">cerramos la clave:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8081-87c3-da51b95eb65c" class="code"><code class="language-SQL">CLOSE SYMMETRIC KEY SK_01;
GO</code></pre><p id="1babadfb-262d-8016-808b-ceead7eb67a1" class="">
</p><p id="1babadfb-262d-8000-bb65-eb8da2e86ec6" class="">Repetimos el proceso impersonando en profe2 e insertando otros 3 alumnos:</p><p id="1babadfb-262d-80c1-8de6-e51259a5d0b5" class="">Abrimos la clave:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8051-97c7-fc921b7d2996" class="code"><code class="language-SQL">OPEN SYMMETRIC KEY SK_02
	DECRYPTION BY CERTIFICATE profe2cert
GO</code></pre><p id="1babadfb-262d-80e5-8e5b-e5419db3a5fa" class="">A√±adimos datos:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-80b9-80aa-d9ddd870dbf3" class="code"><code class="language-SQL">INSERT INTO [autoescuelaP].[dbo].[alumnos] (
    [DNI_cliente],
    [N_cliente],
    [Apel1_cliente],
    [Apel2_cliente],
    [Dir_cliente],
    [Email_cliente],
    [Telf_cliente],
    [localidad_cod_localidad]
)
VALUES
(
    &#x27;55443322L&#x27;,  
    &#x27;Ana&#x27;,
    &#x27;Ruiz&#x27;,
    &#x27;G√≥mez&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_02&#x27;), &#x27;Calle Sierpes 45, Sevilla&#x27;),  
    &#x27;ana.ruiz@hotmail.com&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_02&#x27;), &#x27;654987321&#x27;),  
    41001  
),
(
    &#x27;98765432M&#x27;,
    &#x27;Javier&#x27;,
    &#x27;Hern√°ndez&#x27;,
    &#x27;D√≠az&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_02&#x27;), &#x27;Gran V√≠a 22, Bilbao&#x27;),
    &#x27;javier.hernandez@gmail.com&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_02&#x27;), &#x27;688112233&#x27;),
    48001  
),
(
    &#x27;11223344N&#x27;,
    &#x27;Sof√≠a&#x27;,
    &#x27;Jim√©nez&#x27;,
    &#x27;Moreno&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_02&#x27;), &#x27;Paseo Independencia 10, Zaragoza&#x27;),
    &#x27;sofia.jimenez@yahoo.com&#x27;,
    EncryptByKey(Key_GUID(&#x27;SK_02&#x27;), &#x27;676543219&#x27;),
    50001  
);</code></pre><p id="1babadfb-262d-8094-a896-fe185406c1f3" class="">Cerramos clave:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-80d1-ba62-d019a90dc2e2" class="code"><code class="language-SQL">CLOSE SYMMETRIC KEY SK_02;
GO</code></pre><p id="1babadfb-262d-80b7-bf2a-ebc5c45ac542" class="">
</p><p id="1babadfb-262d-8090-88aa-c8afdc96f6fe" class="">Ahora realizamos una consulta normal y observamos que los campos aparecen encriptados:</p><figure id="1babadfb-262d-80f2-8c41-fa4318b7898a" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_20.12.06.png"><img style="width:834.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_20.12.06.png"/></a></figure><p id="1babadfb-262d-8084-aee9-f82e58295ee4" class="">
</p><p id="1babadfb-262d-804f-b49e-fb14a123fea5" class="">Vamos a realizar una consulta de los datos desde profe1 y como profe2 desencriptando los datos:</p><figure id="1babadfb-262d-80cc-966f-f42669bde7b0" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_20.14.17.png"><img style="width:703px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_20.14.17.png"/></a></figure><p id="1babadfb-262d-805d-b7ba-ea8112374104" class="">
</p><figure id="1babadfb-262d-80b7-bb27-fa920a9dc96c" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_20.15.22.png"><img style="width:684px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_20.15.22.png"/></a></figure><p id="1babadfb-262d-8097-a4fa-fb822642fcf0" class="">
</p><p id="1babadfb-262d-800a-89cd-d95082af9aa6" class="">Como podemos ver, los campos que el profesor que consulta no ha introducido, no es capaz de desencriptarlos y aparecen como ‚ÄúNULL‚Äù.</p><p id="1babadfb-262d-80ce-92a1-ec4446cc5d53" class="">
</p><blockquote id="1babadfb-262d-802d-8f17-e7c9fb096f1f" class=""><mark class="highlight-yellow_background">**Importante recordar que para poder borrar el certificado, debemos borrar antes la clave, sino no nos dejar√° por estar trabajando el certificado con la clave.</mark></blockquote><p id="1babadfb-262d-80ae-98f8-cac8b40722a4" class="">
</p><h3 id="1babadfb-262d-80c5-b60c-e85bec06923a" class="">Ejemplo 2 (encriptaci√≥n columnas)</h3><p id="1babadfb-262d-80c4-a278-cac867990006" class="">Vamos a crear un sistema para registrar pagos de alumnos, los datos de la tarjeta de cr√©dito se almacenar√°n encriptados  y cada profesor solo podr√° ver los datos de los pagos que registr√≥</p><p id="1babadfb-262d-8098-b11e-e2710c8430ad" class="">
</p><p id="1babadfb-262d-803e-bd20-d06203d94a69" class="">Creamos la tabla de pagos</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8097-a2c4-cb4fead01791" class="code"><code class="language-SQL">CREATE TABLE [autoescuelaP].[dbo].[pagos] (
    [ID_pago] INT IDENTITY(1,1) PRIMARY KEY,
    [DNI_alumno] VARCHAR(9) NOT NULL,
    [Monto] DECIMAL(10,2) NOT NULL,
    [Fecha_pago] DATE NOT NULL,
    [Tarjeta_credito] VARBINARY(MAX),  
    [Titular_tarjeta] VARBINARY(MAX)   
);
GO</code></pre><p id="1babadfb-262d-80e1-8bbb-fabf60885d10" class="">
</p><p id="1babadfb-262d-805f-96b5-db35cc53d49a" class="">
</p><p id="1babadfb-262d-80eb-bff6-dd797560991a" class="">Otorgamos permisos:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-80a7-988f-e1b0f7e34f10" class="code"><code class="language-SQL">GRANT SELECT, INSERT ON [pagos] TO profe1, profe2;
GO</code></pre><p id="1babadfb-262d-8053-864f-fc561d75d9d4" class="">
</p><p id="1babadfb-262d-807f-b889-e7093dde90d5" class="">Creamos el procedimiento para a√±adir los pagos:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-80ef-a760-c57ce0a09ee2" class="code"><code class="language-SQL">CREATE PROCEDURE SP_RegistrarPagoEncriptado
    @DNI_alumno VARCHAR(9),
    @Monto DECIMAL(10,2),
    @Fecha_pago DATE,
    @Tarjeta_credito VARCHAR(19),
    @Titular_tarjeta VARCHAR(100)
WITH EXECUTE AS CALLER  -- Esto hace que se ejecute con los permisos del que lo llama.
AS
BEGIN
    DECLARE @ClaveSimetrica VARCHAR(10);

    -- Usa la clave seg√∫n el usuario
    SET @ClaveSimetrica = 
        CASE USER_NAME()
            WHEN &#x27;profe1&#x27; THEN &#x27;SK_01&#x27;
            WHEN &#x27;profe2&#x27; THEN &#x27;SK_02&#x27;
        END;

    -- Abrimos la clave necesaria
    IF @ClaveSimetrica = &#x27;SK_01&#x27;
    BEGIN
        OPEN SYMMETRIC KEY SK_01 DECRYPTION BY CERTIFICATE profe1cert;
    END
    ELSE IF @ClaveSimetrica = &#x27;SK_02&#x27;
    BEGIN
        OPEN SYMMETRIC KEY SK_02 DECRYPTION BY CERTIFICATE profe2cert;
    END

    -- Insertamos los datos con tarjeta y titular encriptados
    INSERT INTO [autoescuelaP].[dbo].[pagos] (
        [DNI_alumno],
        [Monto],
        [Fecha_pago],
        [Tarjeta_credito],
        [Titular_tarjeta]
    )
    VALUES (
        @DNI_alumno,
        @Monto,
        @Fecha_pago,
        EncryptByKey(Key_GUID(@ClaveSimetrica), @Tarjeta_credito),
        EncryptByKey(Key_GUID(@ClaveSimetrica), @Titular_tarjeta)
    );

    -- Cerramos la clave
    IF @ClaveSimetrica = &#x27;SK_01&#x27;
    BEGIN
        CLOSE SYMMETRIC KEY SK_01;
    END
    ELSE IF @ClaveSimetrica = &#x27;SK_02&#x27;
    BEGIN
        CLOSE SYMMETRIC KEY SK_02;
    END
END;</code></pre><p id="1babadfb-262d-80a3-ae77-e5b20d8e577e" class="">
</p><blockquote id="1babadfb-262d-808e-b83a-d4c4753786ad" class="">**Debemos otorgar permisos a los usuarios para ejecutar el procedimiento almacenado con <em><mark class="highlight-red"><mark class="highlight-default_background">GRANT EXECUTE ON [dbo].[SP_RegistrarPagoEncriptado] TO profe1, profe2</mark></mark></em></blockquote><p id="1babadfb-262d-80d0-b7fc-fc9a6fd61569" class="">
</p><p id="1babadfb-262d-8095-93cb-d6808d06adf7" class="">Ahora insertamos pagos como profe1:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8080-a893-f8787b2fdd88" class="code"><code class="language-SQL">EXEC AS USER = &#x27;profe1&#x27;;
GO

EXEC SP_RegistrarPagoEncriptado
    @DNI_alumno = &#x27;12345678A&#x27;,
    @Monto = 250.50,
    @Fecha_pago = &#x27;2025-03-20&#x27;,
    @Tarjeta_credito = &#x27;4111-1111-1111-1111&#x27;,
    @Titular_tarjeta = &#x27;Carlos Garc√≠a L√≥pez&#x27;;
GO
</code></pre><p id="1babadfb-262d-8078-bf96-ed0cf56324e6" class="">
</p><p id="1babadfb-262d-8013-acd9-c06086fba1cc" class="">Insertamos los pagos como profe2:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-802e-aa37-ce1c1621d944" class="code"><code class="language-SQL">EXEC AS USER = &#x27;profe2&#x27;;
GO

EXEC SP_RegistrarPagoEncriptado
    @DNI_alumno = &#x27;55443322L&#x27;,
    @Monto = 300.00,
    @Fecha_pago = &#x27;2025-03-21&#x27;,
    @Tarjeta_credito = &#x27;5500-0000-0000-0004&#x27;,
    @Titular_tarjeta = &#x27;Ana Ruiz G√≥mez&#x27;;
GO</code></pre><p id="1babadfb-262d-80eb-8ce1-c10c98e91bfb" class="">
</p><p id="1babadfb-262d-80e7-b540-e885f8844cbe" class="">Comprobamos:</p><figure id="1babadfb-262d-8087-a2b4-d5c5698cda52" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_21.08.22.png"><img style="width:834.921875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_21.08.22.png"/></a></figure><p id="1babadfb-262d-8078-8303-ccbc638b59ef" class="">
</p><p id="1babadfb-262d-80d0-b075-e4dd472394fd" class="">
</p><figure id="1babadfb-262d-8043-9f2a-f24a59575e5f" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_21.10.23.png"><img style="width:834.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_21.10.23.png"/></a></figure><p id="1babadfb-262d-80fa-864f-c1ac591bea60" class="">
</p><figure id="1babadfb-262d-80c1-a198-ff3d0dcd6b41" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_21.11.16.png"><img style="width:834.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_21.11.16.png"/></a></figure><p id="1babadfb-262d-80d1-9a8b-e2c55481f856" class="">
</p><h3 id="1babadfb-262d-80f9-b295-e0fa8dfb542e" class="">Encriptar usando frase</h3><p id="1babadfb-262d-8017-950d-d9728a608e88" class="">Para encriptar con una frase en vez de con una clave, tan solo tenemos que usar <em><mark class="highlight-pink">EncryptByPassPhrase</mark></em><mark class="highlight-default">, en este caso vamos a guardar la frase en una variable para luego aplicarla.</mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8098-a2d5-d2fa886cbd61" class="code"><code class="language-SQL">DECLARE @FraseSecreta VARCHAR(100) = &#x27;Voy aprobar bases de datos&#x27;;
UPDATE [profesor]
    SET profesor_Dir_profe = EncryptByPassPhrase(@FraseSecreta, &#x27;Calle Gran V√≠a 78, Madrid&#x27;)
    WHERE profesor_DNI_profe = &#x27;09876543Q&#x27;;</code></pre><figure id="1babadfb-262d-8051-bae4-c6d9a8a87e91" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_23.33.34.png"><img style="width:834.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_23.33.34.png"/></a></figure><p id="1babadfb-262d-80b3-b5c4-e12ebe8e7e32" class="">
</p><p id="1babadfb-262d-809b-910f-ecca5a6196d3" class="">Comprobaci√≥n:</p><figure id="1babadfb-262d-80e0-ac0e-c0cc59ba0845" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_23.39.19.png"><img style="width:834.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_23.39.19.png"/></a></figure><p id="1babadfb-262d-805f-af1a-df9a05a149e5" class="">
</p><p id="1babadfb-262d-8078-afa6-f77d997e3172" class="">
</p><h3 id="1babadfb-262d-8070-9f47-d36574c94bf6" class="">Encriptaci√≥n de Backups</h3><blockquote id="1babadfb-262d-8015-8a0f-e7529ab075b5" class=""><mark class="highlight-yellow_background">**Debemos tener en cuenta que para hacer un backup encriptado debemos hacer todo el proceso desde master y el certificado debe generarse en master tambi√©n, de lo contrario nos dar√° un error diciendo que no encuentra el certificado.</mark></blockquote><p id="1babadfb-262d-8064-a8fd-ee944bbded64" class="">Primero crearemos la master key si no la tenemos creada:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-806e-8ed6-f9d7fe8fdd93" class="code"><code class="language-SQL">CREATE MASTER KEY ENCRYPTION BY PASSWORD = &#x27;Abcd1234.&#x27;;
GO</code></pre><p id="1babadfb-262d-8071-955c-f3f12fc45094" class="">Luego creamos el certificado:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-80b0-a8d9-e9da0110fd81" class="code"><code class="language-SQL">CREATE CERTIFICATE [CertificadoBackup]
WITH SUBJECT = &#x27;Certificado encriptar backups&#x27;;
GO</code></pre><p id="1babadfb-262d-80c9-a096-cc7f04d41186" class="">Ahora debemos crear un backup del certificado, adem√°s de que lo recomienda mircosoft tambi√©n es aconsejable puesto que si perdemos el certificado no podremos recuperar el backup que encriptemos.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-8060-a392-d6cb9c6dc0e4" class="code"><code class="language-SQL">BACKUP CERTIFICATE [CertificadoBackup]
	TO FILE = &#x27;C:\Backup\Certificados\CertificadoBackup.cert&#x27;
	WITH PRIVATE KEY (
						FILE = &#x27;C:\Backup\Certificados\CertificadoBackup.key&#x27;,
						ENCRYPTION BY PASSWORD = &#x27;Abcd1234.&#x27;
					 );
GO</code></pre><blockquote id="1babadfb-262d-80b8-9908-f593b031e1d5" class=""><mark class="highlight-yellow_background">**Debemos tener creado el directorio donde le mandamos guardar el backup.</mark></blockquote><figure id="1babadfb-262d-8033-aca9-f32a8c3b2a10" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_23.55.57.png"><img style="width:834.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-18_a_las_23.55.57.png"/></a></figure><p id="1babadfb-262d-8084-b60b-f26c2c55d83c" class="">
</p><p id="1babadfb-262d-8081-a9c2-efaf00acfdb1" class="">Ahora creamos el backup de la base de datos encriptado:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1babadfb-262d-801f-bbfe-c79661ee5c4b" class="code"><code class="language-SQL">BACKUP DATABASE [AutoescuelaP]
	TO DISK = &#x27;C:\Backup\AutoescuelaP.bak&#x27;
	WITH COMPRESSION, ENCRYPTION(ALGORITHM = AES_256,
	SERVER CERTIFICATE = [CertificadoBackup]);
GO</code></pre><figure id="1babadfb-262d-80f9-9093-e9dfa914b947" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_0.11.39.png"><img style="width:834.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_0.11.39.png"/></a></figure><p id="1bbbadfb-262d-80b6-9289-d9ae0d4b47fb" class="">
</p><p id="1babadfb-262d-8027-b731-c5a9d5863719" class="">Ahora abrimos otra m√°quina virtual, en mi caso he usado una con Windows10 y SSMS20. Me he conectado con un usuario con rol Sysadmin e identicacion SQL Server (De otra manera no me dejaba recuperar el certificado)</p><p id="1bbbadfb-262d-8022-8650-f18de2e6cf3d" class="">Creamos clave master</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80e0-a49a-f1dfdd522f41" class="code"><code class="language-SQL">CREATE MASTER KEY ENCRYPTION BY PASSWORD = &#x27;Abcd1234.&#x27;;
GO</code></pre><p id="1bbbadfb-262d-80b8-927d-e5250e9b050e" class="">Restauramos el certificado:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-8010-9441-c35d80718dd0" class="code"><code class="language-SQL">CREATE CERTIFICATE [CertificadoBackup]
FROM FILE = &#x27;C:\Certificados\CertificadoBackup.cert&#x27;
WITH PRIVATE KEY (
    FILE = &#x27;C:\Certificados\CertificadoBackup.key&#x27;,
    DECRYPTION BY PASSWORD = &#x27;Abcd1234.&#x27; -- Contrase√±a del backup del certificado
);
GO</code></pre><p id="1bbbadfb-262d-80f8-9850-d586ec93f9a5" class="">Restauramos el backup de la base de datos:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-801c-a3f6-dcaa73f17548" class="code"><code class="language-SQL">RESTORE DATABASE [AutoescuelaP]
FROM DISK = &#x27;C:\Backup\AutoescuelaP.bak&#x27;
WITH REPLACE
GO</code></pre><figure id="1bbbadfb-262d-8039-a1ac-efd87d3e09c6" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_3.20.21.png"><img style="width:834.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_3.20.21.png"/></a></figure><p id="1bbbadfb-262d-8020-9605-d2aeee0d122a" class=""><mark class="highlight-yellow_background">**Debemos mover tambi√©n los archivos que use la base de datos (en este caso carpeta DATA) y debemos tener en cuenta que en la nueva m√°quina tendremos que darle permisos al login para que tenga control total sobre la carpeta donde se va a reescribir.</mark></p><p id="1bbbadfb-262d-80e9-94bf-de9633508206" class="">
</p><h3 id="1bbbadfb-262d-806c-9f8d-e928371e39d4" class="">Encriptaci√≥n de TDE (Transparent data encryption)</h3><p id="1bbbadfb-262d-809f-b279-d1e80b483a2b" class="">Cifra los archivos de la base de datos (.mdf,¬†.ndf,¬†.ldf) y los backups (.bak).</p><p id="1bbbadfb-262d-8038-a0ec-ee18ac96e5a7" class="">Creamos la master key:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-806c-93f5-daee4ec39678" class="code"><code class="language-SQL">CREATE MASTER KEY ENCRYPTION BY PASSWORD = &#x27;Abcd1234.&#x27;;
GO</code></pre><p id="1bbbadfb-262d-8097-8e8a-fa32c9716f99" class="">Creamos el certificado:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-8074-9948-d805e7402737" class="code"><code class="language-SQL">CREATE CERTIFICATE [CertificadoTDE]
WITH SUBJECT = &#x27;Certificado encriptar TDE&#x27;;
GO</code></pre><p id="1bbbadfb-262d-8099-a950-fb7a76378df6" class="">Creamos backup del certificado:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-8099-ae92-c04e1fd2675c" class="code"><code class="language-SQL">BACKUP CERTIFICATE [CertificadoTDE]
	TO FILE = &#x27;C:\Backup\Certificados\CertificadoTDE.cert&#x27;
	WITH PRIVATE KEY (
						FILE = &#x27;C:\Backup\Certificados\KeyTDE.key&#x27;,
						ENCRYPTION BY PASSWORD = &#x27;Abcd1234.&#x27;
					 );
GO</code></pre><p id="1bbbadfb-262d-8009-b6ab-ee6f10e49a43" class="">Ahora pasamos a usar nuestra base de datos, creamos la clave de encriptaci√≥n:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80ab-92d4-c8883b65d400" class="code"><code class="language-SQL">CREATE DATABASE ENCRYPTION KEY
	WITH ALGORITHM = AES_256
	ENCRYPTION BY SERVER CERTIFICATE CertificadoTDE;
GO</code></pre><p id="1bbbadfb-262d-809e-ab05-f31979a8620c" class="">Y la activamos:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-8077-8913-f0245316ab1d" class="code"><code class="language-SQL">ALTER DATABASE [AutoescuelaP] SET ENCRYPTION ON;
GO</code></pre><p id="1bbbadfb-262d-80ad-a08e-c9566e3d6533" class="">Ahora comprobamos el estado:</p><figure id="1bbbadfb-262d-8042-963e-dcd4b6cff216" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_3.51.03.png"><img style="width:504px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_3.51.03.png"/></a></figure><p id="1bbbadfb-262d-803c-8862-e4af1936acdb" class=""><mark class="highlight-yellow_background">** 3 significa que TDE se encuentra activado.</mark></p><p id="1bbbadfb-262d-801b-9952-fdf4c0563704" class="">
</p><p id="1bbbadfb-262d-80f7-b509-ee20df8c5196" class="">Ahora hacemos un backup completo y un backup de log (el de log no es imprescindible)</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80b1-8301-caf8b34b593d" class="code"><code class="language-SQL">-- Hacemos bakcup completo
BACKUP DATABASE AutoescuelaP
TO DISK = &#x27;C:\Backup\RecoveryfullWithTDE.bak&#x27;;
GO

-- Hacemos backup de log
BACKUP LOG AutoescuelaP
TO DISK = &#x27;C:\Backup\RecoveryWithTDE_log.bak&#x27;;
GO</code></pre><p id="1bbbadfb-262d-80b7-af72-c037c2e895fc" class="">
</p><p id="1bbbadfb-262d-800a-b3a5-d452c0d87257" class="">En este caso, vamos a probar a restaurar la base de datos en la otra m√°quina virtual mediante ATTACH, para ello ejecutamos en nuestra m√°quina principal para detener los procesos y separar los archivos de la base de datos de la instancia:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80e5-9faa-fb7f0af920ad" class="code"><code class="language-SQL">USE master;
ALTER DATABASE AutoescuelaP SET SINGLE_USER WITH ROLLBACK IMMEDIATE;  
EXEC sp_detach_db &#x27;AutoescuelaP&#x27;;
GO</code></pre><p id="1bbbadfb-262d-802f-a774-ca51aa6d2ddf" class="">
</p><p id="1bbbadfb-262d-801a-8c13-dc9e734794f4" class="">Ahora vamos a la nueva m√°quina virtual e intentamos restaurar la base de datos realizando un ATTACH pero vemos que nos da error porque falta el certificado:</p><figure id="1bbbadfb-262d-8005-b570-cdf45b8076fe" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_10.21.45.png"><img style="width:834.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_10.21.45.png"/></a></figure><p id="1bbbadfb-262d-801c-a9dd-d69d963e760e" class="">Restauramos el certificado:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80a4-8429-cea61a4ce72d" class="code"><code class="language-SQL">CREATE CERTIFICATE [CertificadoTDE]
FROM FILE = &#x27;C:\DATA\CertificadoTDE.cert&#x27;
WITH PRIVATE KEY (
    FILE = &#x27;C:\DATA\KeyTDE.key&#x27;,
    DECRYPTION BY PASSWORD = &#x27;Abcd1234.&#x27; -- Contrase√±a del backup del certificado
);
GO</code></pre><p id="1bbbadfb-262d-803c-82a7-f06824f413a3" class="">Ahora volvemos a intentar relizar el ATTACH:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-809c-962e-fdf426b23650" class="code"><code class="language-SQL">
CREATE DATABASE AutoescuelaP  
ON (FILENAME = &#x27;C:\DATA\AutoescuelaP.mdf&#x27;),  
   (FILENAME = &#x27;C:\DATA\AutoescuelaP_log.ldf&#x27;)  
FOR ATTACH;
GO</code></pre><p id="1bbbadfb-262d-8018-928a-e5328fc4ed77" class="">La base de datos se crear sin errores:</p><figure id="1bbbadfb-262d-802c-a01e-f582cebb26b2" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_10.36.05.png"><img style="width:834.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_10.36.05.png"/></a></figure><p id="1bbbadfb-262d-8075-9332-ce74efe8b7a7" class="">
</p><h3 id="1bbbadfb-262d-80a8-950d-f0abe64a181a" class="">Hashing</h3><p id="1bbbadfb-262d-80e1-a960-e4e95d82396a" class="">El hashing es un proceso criptogr√°fico que convierte una contrase√±a en una cadena de caracteres de longitud fija. Esto se hace usando funciones hash como SHA-2 (SHA-256, SHA-512) o MD5</p><p id="1bbbadfb-262d-80f6-96f3-d2bc76a41e28" class="">El salting es una t√©cnica adicional al hashing. Consiste en agregar una cadena aleatoria (sal) a la contrase√±a antes de generar el hash. Esto previene ataques como Rainbow Tables.</p><p id="1bbbadfb-262d-801b-b543-f03a88aef06a" class="">No puedes recuperar una contrase√±a almacenada en forma de <strong>hash</strong>, porque el <strong>hashing es un proceso unidireccional</strong> (no reversible). Esto significa que, una vez que una contrase√±a se convierte en un hash, no se puede convertir de nuevo en la contrase√±a original.</p><p id="1bbbadfb-262d-80fc-a3fa-d36ab806577b" class="">
</p><p id="1bbbadfb-262d-8076-8785-e7d0e6a73160" class="">Aunque el hasing se suele usar para contrase√±as, en este caso voy a aplicarlo a mi base de datos para ocultar los n√∫meros de cuenta de los trabajadores cada vez que se inserte una n√≥mina en la base de datos.</p><p id="1bbbadfb-262d-8075-a0aa-f534d3e50deb" class="">Para ello, vamos a seguir el ejemplo dado en clase y vamos a generar un trigger que salte cada vez que se intente insertar un registro en la tabla nominas, de esta manera el trigger coger√° los valores que se quieren insertar, seleccionar√° el n√∫mero de cuenta, le aplicar√° el hash, luego se reforzar√° la seguridad aplicando salting y por √∫ltimo registrar√° el dato en la tabla.</p><p id="1bbbadfb-262d-80b3-bafd-fd0c747caaf3" class="">Generamos el trigger:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80a2-ac99-d54f40918458" class="code"><code class="language-SQL">CREATE OR ALTER TRIGGER insertar_nomina_hash
ON Nomina
INSTEAD OF INSERT
AS
DECLARE
	@salt VARCHAR(20),@hash VARCHAR(64),
	@cuenta VARCHAR(30),@hashedcuenta VARCHAR(80),
	@Id_Nomina VARCHAR(12),@Department VARCHAR(12),  
    @Nivel VARCHAR(12),@H_extra VARCHAR(12),  
    @contrato_ID_contrato INT;  
	SELECT @Id_Nomina = ins.Id_Nomina,  
		   @Department = ins.Department,  
           @Nivel = ins.Nivel,  
           @H_extra = ins.H_extra,  
           @cuenta = ins.N_Cuenta,  
           @contrato_ID_contrato = ins.contrato_ID_contrato  
	FROM INSERTED ins;
BEGIN
	SET @cuenta = (SELECT Id_Nomina FROM inserted)
	SELECT @salt = CONVERT(VARCHAR(20), CRYPT_GEN_RANDOM(8),2)
	SET @hash = CONVERT(VARCHAR(64),HashBytes(&#x27;SHA2_256&#x27;, (@salt + @cuenta)),2)
	SET @hashedcuenta = @salt + @hash;
	INSERT INTO Nomina ([Id_Nomina], [Department], [Nivel], [H_extra], [N_Cuenta], [contrato_ID_contrato])
	VALUES (@Id_Nomina, @Department, @Nivel, @H_extra, @hashedcuenta, @contrato_ID_contrato);  
END;
GO</code></pre><p id="1bbbadfb-262d-80ba-acaf-ccaaa2ac36e2" class="">Ahora vamos a intentar insertar una n√≥mina en la tabla:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80b1-94f0-e8eb15b0d9f7" class="code"><code class="language-SQL">INSERT INTO [dbo].[Nomina] 
    ([Id_Nomina], [Department], [Nivel], [H_extra], [N_Cuenta], [contrato_ID_contrato])  
VALUES  
    (&#x27;NOM011&#x27;, &#x27;IT&#x27;, &#x27;Senior&#x27;, &#x27;5&#x27;, &#x27;ES1234567890123456789012&#x27;, 3);  
GO</code></pre><p id="1bbbadfb-262d-80ed-ad9f-d828965c9a48" class="">Comprobamos y vemos que el n√∫mero de cuenta aparece encriptado:</p><figure id="1bbbadfb-262d-80fd-8765-eefb062c7eb6" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_12.35.10.png"><img style="width:834.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_12.35.10.png"/></a></figure><p id="1bbbadfb-262d-80e6-b287-f4307a898723" class="">
</p><p id="1bbbadfb-262d-80f0-beb4-ebfc9cec8b53" class="">Aunque el hashing no se puede revertir, si que podemos aplicar el hash a una contrase√±a y saber si coinciden el has nuevo con el antiguo y eso nos sirve para comprobar si la contrase√±a introducida coincide con la guardada, ya que el hash da siempre el mismo resultado si se le aplica a lo mismo y el salt es una cadena de caracteres a√±adida.</p><p id="1bbbadfb-262d-80fb-ae2a-ecbeeb86bbf7" class="">Vamos a comprobarlo, aplic√°ndolo a la cuenta a la que le hemos aplicado el salt y el hash en la tabla N√≥mina, de esta manera al ingresar la nomina podemos no saber que cuenta tenemos almacenada pero si podemos saber si en la que vamos hacer el ingreso es la correcta.</p><p id="1bbbadfb-262d-8012-83a2-c690137d337e" class="">Generamos la funci√≥n:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80de-bcd3-c19d0cd5591a" class="code"><code class="language-SQL">
CREATE OR ALTER FUNCTION cuentavalida (
        @Id_Nomina varchar(20),@nuevacuenta varchar(30) 
)
RETURNS  bit            
AS

BEGIN
    DECLARE 
        @isValid bit,@cuentalmacenada varchar(80),@nuevacuentahash varchar(80), 
        @salt varchar(16),@hash varchar(64) 
    SET @cuentalmacenada = (SELECT [N_Cuenta] 
								FROM Nomina 
								WHERE Id_Nomina = @Id_Nomina)
	IF (@cuentalmacenada IS NULL) RETURN 0
        SET @salt = SUBSTRING(@cuentalmacenada, 1, 16)
        SET @hash = CONVERT(VARCHAR(64),HashBytes(&#x27;SHA2_256&#x27;, (@salt + @nuevacuenta)),2)
        SET @nuevacuentahash = @salt + @hash;

        IF (@cuentalmacenada != @nuevacuentahash) 
            SET @isValid = 0 
        ELSE
            SET @isValid = 1 
        RETURN @isValid

END;
GO</code></pre><p id="1bbbadfb-262d-80fd-9320-c57a19e33837" class="">No consigo detectar el error, aunque la funci√≥n no me da error, nunca me detecta el valor correcto:</p><figure id="1bbbadfb-262d-80f5-9f19-e1536062bf30" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_13.50.35.png"><img style="width:602px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_13.50.35.png"/></a></figure><p id="1bbbadfb-262d-8036-bcf6-e1911ffb40eb" class="">Detectado el error:</p><p id="1bbbadfb-262d-80d6-bf92-e32c2cfab6af" class="">El error estaba en el trigger ya que en vez de estar tomando el n¬∫ de cuenta para aplicar el hash, estaba utilizando el n¬∫ de n√≥mina. Al cambiar la variable ya funcion√≥ todo correctamente.</p><figure id="1bbbadfb-262d-80db-a60b-c32bdba7fdb2" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_14.22.18.png"><img style="width:622px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_14.22.18.png"/></a></figure><p id="1bbbadfb-262d-80e1-b8b7-e9ee48bc8aa9" class="">
</p><figure id="1bbbadfb-262d-802b-b8d2-d6152ed6be89" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_14.22.43.png"><img style="width:612px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_14.22.43.png"/></a></figure><p id="1bbbadfb-262d-803a-9d9d-ee07256c310c" class="">
</p><h2 id="1bbbadfb-262d-80cf-b00e-eea0d76da940" class="">DDM Dynamic Data Masking</h2><p id="1bbbadfb-262d-805c-9a36-fba8eb4ff7ce" class="">Dynamic Data Masking (DDM), que es una caracter√≠stica de seguridad dise√±ada para limitar la exposici√≥n de datos sensibles a usuarios sin privilegios.</p><p id="1bbbadfb-262d-8005-a022-dad578b57616" class="">Caracter√≠sticas principales en SQL Server :<br/>Protecci√≥n a nivel de columna - Puedes aplicar m√°scaras a columnas espec√≠ficas que contienen informaci√≥n sensible<br/>M√∫ltiples funciones de enmascaramiento:<br/>M√°scara predeterminada: Muestra XXXX para tipos de datos de cadena, 0 para tipos num√©ricos y 01.01.1900 para fecha/hora<br/>M√°scara de correo electr√≥nico: Expone solo la primera letra y el dominio (ej., a****@ejemplo.com)<br/>M√°scara parcial: Muestra los primeros y √∫ltimos caracteres (ej., ABCD1234 ‚Üí AB****34)<br/>M√°scara de cadena personalizada: Permite patrones de reemplazo personalizados<br/>Acceso basado en privilegios - Los usuarios con los permisos adecuados (p.ej., permiso UNMASK) pueden ver los datos originales<br/></p><p id="1bbbadfb-262d-8064-b5a0-fa8317f717fc" class="">
</p><p id="1bbbadfb-262d-8030-9f67-cc75405d627b" class="">Creamos una tabla con campos enmascarados:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-8048-820a-f2eea08bdc48" class="code"><code class="language-SQL">DROP TABLE IF EXISTS aprobados
GO
CREATE TABLE aprobados(
	ID INT IDENTITY PRIMARY KEY,
	Nombre NVARCHAR(15) MASKED WITH (FUNCTION = &#x27;default()&#x27;) NULL,
	Apellidos NVARCHAR(30) MASKED WITH (FUNCTION = &#x27;default()&#x27;) NULL,
	Email NVARCHAR(18) MASKED WITH (FUNCTION = &#x27;email()&#x27;) NULL,
	N_cuenta NVARCHAR (25) MASKED WITH (FUNCTION = &#x27;partial(0,&quot;XXXX-XXXX-XXXX-&quot;,4)&#x27;) NULL
);
GO</code></pre><p id="1bbbadfb-262d-80a4-a9bf-eaf560ca0caf" class="">Ahora insertamos valores:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80bd-b6a3-e773e39cb126" class="code"><code class="language-SQL">INSERT INTO aprobados (Nombre, Apellidos, Email, N_Cuenta)
VALUES (&#x27;Borja&#x27;, &#x27;Costa Rojo&#x27;, &#x27;cjgalego@gmail.com&#x27;, &#x27;2100-2938-7765-9876-2345&#x27;);
GO</code></pre><p id="1bbbadfb-262d-809b-baa1-ec4e8cebb7db" class="">Si realizamos una consulta con un usuario con permisos, se ver√°n todos los datos pero si realizamos una consulta con un usuario sin permisos, solo con permiso de consulta, se muestra la informaci√≥n enmascarada de la siguiente manera:</p><figure id="1bbbadfb-262d-80a3-b8be-d00067e7d1ba" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_17.16.55.png"><img style="width:456px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_17.16.55.png"/></a></figure><p id="1bbbadfb-262d-80cd-9aea-ecf73b99a467" class="">Podemos hacer que un usuario vea los campos concediendo permisos UNMASK:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80c6-b5db-f6fc9d12e406" class="code"><code class="language-SQL">GRANT UNMASK ON aprobados TO profe1;
GO</code></pre><figure id="1bbbadfb-262d-800a-a4df-df4d940d1309" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_17.21.52.png"><img style="width:518px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_17.21.52.png"/></a></figure><p id="1bbbadfb-262d-806d-8ddc-d8c78b98bc7b" class="">Ahora vamos a probar a desenmascarar solo un campo, concedemos permisos a profe2 y desenmascaramos el correo:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-809f-ab4a-e31eaf169cd4" class="code"><code class="language-SQL">GRANT SELECT ON aprobados TO profe2;
GO

ALTER TABLE aprobados
	ALTER COLUMN email DROP MASKED;
GO</code></pre><figure id="1bbbadfb-262d-80b6-8eae-d30a518c51e7" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_17.45.53.png"><img style="width:444px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_17.45.53.png"/></a></figure><p id="1bbbadfb-262d-8003-b866-faceeade6b09" class="">
</p><h2 id="1bbbadfb-262d-8084-a110-ec9cc71aa608" class="">Secuencias</h2><p id="1bbbadfb-262d-80d8-b8c4-e4640dd53051" class="">Las secuencias son objetos de base de datos que generan una¬†<strong>secuencia num√©rica ordenada</strong>, independiente de las tablas. Fueron introducidas en SQL Server 2012 y ofrecen mayor flexibilidad que las columnas de identidad. La principal diferencia con el IDENTITY es que la secuencia es un objeto independiente de la propia base de datos y podemos trabajar con la secuencia en diferentes tablas.</p><p id="1bbbadfb-262d-80f0-b3be-ce0a3f86dfc8" class="">
</p><p id="1bbbadfb-262d-8061-8e94-ee62b3f3ff51" class="">Vamos a suponer que queremos que a medida que registremos clientes en nuestra autoescuela, se vayan distribuyendo en aulas, en nuestra autoescuela disponemos de 3 aulas y en cada aula caben 5 alumnos. Usando una secuencia que se reinicie cada 15 alumnos (cuando se completen todas la aulas) podemos distribuir a los alumnos y calcularemos el aula que le corresponde dividiendo entre las 3 aulas. Vamos a probarlo:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-80bb-acda-f074c6125d31" class="code"><code class="language-SQL">-- Creamos la secuencia
CREATE SEQUENCE dbo.ControlAulas
START WITH 1
INCREMENT BY 1
MINVALUE 1
MAXVALUE 15
CYCLE;

-- Actualizamos el aula autom√°ticamente usando un valor calculado
ALTER TABLE dbo.clientes
ADD CONSTRAINT DF_Aula DEFAULT 
((NEXT VALUE FOR dbo.ControlAulas - 1)/5 % 3 + 1) FOR aula;
GO</code></pre><p id="1bbbadfb-262d-80a9-a75a-fceb275895e9" class="">Ahora introducimos 20 clientes y vemos si funciona:</p><figure id="1bbbadfb-262d-80ae-873a-c39598394f71" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_22.46.18.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_22.46.18.png"/></a></figure><p id="1bbbadfb-262d-8010-bc4b-fa0fdb414490" class="">
</p><blockquote id="1bbbadfb-262d-80b0-81eb-cc5305269e1b" class=""><mark class="highlight-yellow_background">**Si tuvi√©semos los clientes distribuidos en varias tablas, podr√≠amos usar igualmente la secuencia puesto que funciona en todas las tablas de la base de datos.</mark></blockquote><p id="1bbbadfb-262d-808c-8bcf-c60fcb30f21e" class="">Podr√≠amos por ejemplo usar esta secuencia y este supuesto para que cada 5 clientes, la secuencia diese un salto, de esta forma dejar√≠amos siempre un hueco vac√≠o en cada aula para posibles incorporaciones de urgencia. Bastar√≠a que cuando sequence valiese 5 se ejecutase un NEXT VALUE FOR [dbo].[ControlAulas].</p><h2 id="1bbbadfb-262d-80f3-9110-c92f2aae55dc" class="">ROW LEVEL SECURITY (RLS)</h2><p id="1bbbadfb-262d-8067-9a25-f93fc9f27c67" class=""><strong>Row-Level Security (RLS) en SQL Server</strong>¬†es una funcionalidad de seguridad que permite controlar el acceso a¬†<strong>filas espec√≠ficas</strong>¬†de una tabla en funci√≥n de las caracter√≠sticas del usuario que ejecuta la consulta. Su objetivo es garantizar que los usuarios solo puedan ver o modificar los datos relevantes para su contexto, sin necesidad de modificar la l√≥gica de la aplicaci√≥n.</p><p id="1bbbadfb-262d-80bc-a604-f33b378514cf" class=""><strong>Predicados de filtro:</strong> Limitan las filas que se pueden leer (SELECT)<br/><br/><br/><strong>Predicados de bloqueo:</strong> Limitan las filas donde se pueden realizar operaciones de modificaci√≥n (INSERT, UPDATE, DELETE)</p><p id="1bbbadfb-262d-806b-8c17-cd07ef8eff71" class="">
</p><p id="1bbbadfb-262d-8088-9f6f-f4f26d452609" class="">Vamos a intentar implementar un Row Level Security para que cada profesor de practica solo tenga acceso a las pr√°cticas de sus alumnos y no al resto de practicas de los dem√°s alumnos</p><p id="1bbbadfb-262d-805d-84ed-dfd00ae4ea0e" class="">Para ello comenzamos creando la funci√≥n de seguridad:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-8086-9198-da00f05585c3" class="code"><code class="language-SQL">CREATE FUNCTION dbo.fn_seguridad_profesor(@DNI_profe AS SYSNAME)
RETURNS TABLE
WITH SCHEMABINDING
AS
RETURN (
    SELECT 1 AS acceso
    WHERE @DNI_profe = USER_NAME()
    OR IS_ROLEMEMBER(&#x27;db_owner&#x27;) = 1
);
GO </code></pre><p id="1bbbadfb-262d-80c3-8e59-d97db298a75c" class="">Ahora creamos la pol√≠tica de seguridad:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bbbadfb-262d-8011-8988-cd16f85068ce" class="code"><code class="language-SQL">CREATE SECURITY POLICY PoliticaSeguridadPractica
ADD FILTER PREDICATE dbo.fn_seguridad_profesor(profe_practicas_profesor_DNI_profe) 
ON dbo.practica
WITH (STATE = ON);
GO</code></pre><p id="1bbbadfb-262d-8033-9ce3-f4f3f77ed6b8" class="">Ahora creamos un usuario para un profesor y hacemos una consulta impersonandonos:</p><figure id="1bbbadfb-262d-80db-8e35-d7d731397fcb" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_23.54.55.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_23.54.55.png"/></a></figure><p id="1bbbadfb-262d-8070-9213-e3a00ac287e2" class="">Como podemos ver, solo se muestran las pr√°cticas realizadas por el propio profesor. Sin embargo, si hacemos la misma consulta con un usuario con todos los permisos, observamos que se muestran todos los datos de todos los clientes:</p><figure id="1bbbadfb-262d-8009-9b00-cf7d43639263" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_23.56.43.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-19_a_las_23.56.43.png"/></a></figure><p id="1bbbadfb-262d-80d8-bfd4-c399866c3c00" class="">
</p><blockquote id="1bbbadfb-262d-802c-ac0e-d5c12936a0c4" class=""><mark class="highlight-yellow_background">Para entenderlo mejor, se podr√≠a decir que la funci√≥n de seguridad es un listado de reglas sobre quien puede o no puede acceder a ciertos datos y la pol√≠tica de seguridad es la que nos dice a que aplicamos la funci√≥n de seguridad y en que casos.</mark></blockquote><blockquote id="1bbbadfb-262d-8073-8ef2-f2f45dd7eb9b" class=""><mark class="highlight-yellow_background">**Debemos tener en cuenta que si solo usamos FILTER PREDICATE, los usuarios que no puedan ver el contenido si que podr√°n editarlo, eso quiere decir que si un usuario conoce alg√∫n dato de la tabla podr√≠a modificarlo o borrarlo. Para evitar este tipo de fallos siempre se debe usar FILTER PREDICATE combinado con BLOCK PREDICATE.</mark></blockquote><p id="1bbbadfb-262d-8090-a9fe-fe8cd32f23c9" class="">
</p><h3 id="1bbbadfb-262d-800c-895c-c504f5c19a67" class="">Otro ejemplo de RLS</h3><p id="1bcbadfb-262d-806a-b862-c9dd25809f9d" class="">Vamos a suponer que tenemos una tabla trabajadores con sus departamentos y sus usuarios, queremos que cada usuario solo tenga permisos para consultar y editar datos de su propio departamento:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-80a9-b5f2-f4712e1e8ee8" class="code"><code class="language-SQL">CREATE TABLE trabajadores (
    id INT IDENTITY(1,1) PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    apellidos VARCHAR(100) NOT NULL,
    telefono VARCHAR(15) NOT NULL,
    sueldo DECIMAL(10,2) NOT NULL,
    puesto VARCHAR(50) NOT NULL,
    usuario VARCHAR(50) NOT NULL,
    departamento VARCHAR(50) CHECK (departamento IN (&#x27;Recursos humanos&#x27;, &#x27;Log√≠stica&#x27;, &#x27;Administraci√≥n&#x27;)));
GO</code></pre><p id="1bcbadfb-262d-8052-895c-fceac9a52d59" class="">Creamos la funci√≥n  de seguridad:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-8000-8df1-e7a700614884" class="code"><code class="language-SQL">CREATE FUNCTION dbo.fn_FiltroPorDepartamento(@departamento VARCHAR(50))
RETURNS TABLE
WITH SCHEMABINDING
AS
RETURN (
    SELECT 1 AS acceso
    FROM dbo.trabajadores
    WHERE departamento = @departamento AND usuario = USER_NAME()
);
GO</code></pre><p id="1bcbadfb-262d-80c9-8496-fb84f97600a1" class="">Creamos la pol√≠tica de seguridad:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-8050-bec7-f4c3ec26d332" class="code"><code class="language-SQL">CREATE SECURITY POLICY Trabajadores_Policy
ADD FILTER PREDICATE dbo.fn_FiltroPorDepartamento(departamento) ON dbo.trabajadores,
ADD BLOCK PREDICATE dbo.fn_FiltroPorDepartamento(departamento) ON dbo.trabajadores
WITH (STATE = ON);
GO</code></pre><p id="1bcbadfb-262d-803c-a881-c2982e2dd3f2" class="">Y ahora realizamos pruebas, el usuario de recursos humanos puede ver y editar datos de trabajadores de su departamento, incluso a√±adir trabajadores si son de su propio departamento pero no podr√° ver ni editar nada de otros departamentos:</p><figure id="1bcbadfb-262d-80a4-98ab-f9ddf2b26326" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_10.55.28.png"><img style="width:670px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_10.55.28.png"/></a></figure><p id="1bcbadfb-262d-80c9-a381-d788c7441181" class="">Ahora probamos a insertar un trabajador de otro departamento y nos da error:</p><figure id="1bcbadfb-262d-8025-bec7-f7244d046b97" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_10.58.49.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_10.58.49.png"/></a></figure><p id="1bcbadfb-262d-8065-b803-d4f619349a10" class="">Sin embargo si la inserci√≥n es de su propio departamento si nos deja:</p><figure id="1bcbadfb-262d-80da-9861-ce667605ff8a" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_10.59.55.png"><img style="width:1074.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_10.59.55.png"/></a></figure><p id="1bcbadfb-262d-8076-8a0b-dfa29ac4a063" class="">
</p><h2 id="1bcbadfb-262d-8027-963a-de10e3e6184f" class="">Always Encrypted</h2><p id="1bcbadfb-262d-80be-b241-c243ca9a4252" class="">Encriptar la circulaci√≥n de datos entre un cluente y el servidor.</p><p id="1bcbadfb-262d-8039-bcc5-df3246b688d0" class=""><strong>Column Encryption Key (CEK)</strong></p><p id="1bcbadfb-262d-807c-9f47-f7dc585c7d9b" class="">La <strong>Column Encryption Key (CEK)</strong> es una clave utilizada para cifrar y descifrar los valores de las columnas de datos. Esta clave es espec√≠fica de cada columna que deseas cifrar.</p><p id="1bcbadfb-262d-8056-a391-e77583129952" class=""><strong>Column Master Key (CMK)</strong></p><p id="1bcbadfb-262d-8087-9462-ee0236063721" class="">La <strong>Column Master Key (CMK)</strong> es una clave maestra que se utiliza para cifrar las Column Encryption Keys (CEK). Es la clave de m√°s alto nivel y se asegura de proteger las CEK de manera segura.</p><p id="1bcbadfb-262d-80ef-8fa7-f04349c8fc32" class="">
</p><p id="1bcbadfb-262d-8013-b3ad-c2591dacac5f" class=""><strong>Cifrado Determin√≠stico (Deterministic Encryption)</strong></p><p id="1bcbadfb-262d-80ce-b4b8-f958cfc4dc75" class="">El <strong>cifrado determin√≠stico</strong> genera el mismo valor cifrado para una entrada de datos id√©ntica cada vez que se cifra. Esto significa que si tienes dos filas con el mismo valor en una columna, su valor cifrado ser√° el mismo, sin importar cu√°ntas veces se cifre.</p><p id="1bcbadfb-262d-80f0-a01e-ec55f2e58d89" class=""><strong>Cifrado Aleatorio (Randomized Encryption)</strong></p><p id="1bcbadfb-262d-8056-a765-c405ec8abd46" class="">El <strong>cifrado aleatorio</strong> genera un valor cifrado diferente cada vez que se cifra el mismo dato, incluso si los valores de entrada son iguales. Esto significa que, aunque los datos originales sean id√©nticos, su representaci√≥n cifrada ser√° diferente en cada operaci√≥n de cifrado.</p><p id="1bcbadfb-262d-806a-a7f8-c28f9f805cec" class="">
</p><p id="1bcbadfb-262d-80b9-9418-d896fbfb1960" class="">Vamos a la barra lateral y pinchamos sobre nuestra base de datos con el boton derecho, luego Task y luego ‚ÄúEncrypt Columns‚Ä¶‚Äù.</p><figure id="1bcbadfb-262d-8017-8a44-f8e9e19fc38b" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_17.00.21.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_17.00.21.png"/></a></figure><p id="1bcbadfb-262d-80e1-851a-efada10dcfc0" class="">
</p><p id="1bcbadfb-262d-809a-bd98-f70a5a1dff9b" class="">Ahora seleccionamos las columnas que queremos encriptar, en este caso vamos a encriptar los datos de las tarjetas de cr√©dito usadas en los pagos, podemos escoger entre cifrado deterministico o random:</p><figure id="1bcbadfb-262d-8071-963b-c6877b9ff670" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_17.03.33.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_17.03.33.png"/></a></figure><p id="1bcbadfb-262d-8016-baae-eaa5abe2c683" class="">
</p><p id="1bcbadfb-262d-8094-b10b-ec64c863debf" class="">La siguiente pantalla la dejamos tal y compo est√°, para que se almacene en windows (podr√≠amos almacenar en Azure tambi√©n).</p><figure id="1bcbadfb-262d-80a7-a430-da74a9af8d68" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_17.04.44.png"><img style="width:1074.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_17.04.44.png"/></a></figure><p id="1bcbadfb-262d-808a-957a-f9887ef1bd06" class="">
</p><p id="1bcbadfb-262d-80fe-9a17-c6576e7adfb7" class="">Una vez termine de realizar las operaciones, realizamos la consulta y comprobamos que los datos est√°n encriptados</p><figure id="1bcbadfb-262d-80a7-a7bd-d5e96365d041" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_17.21.24.png"><img style="width:1074.953125px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_17.21.24.png"/></a></figure><hr id="1bcbadfb-262d-80fa-ba63-e8ada607db75"/><h1 id="1bcbadfb-262d-8044-995b-d649d0a72635" class="">2.- Auditor√≠as</h1><p id="1bcbadfb-262d-8046-be4f-fd38aa8ad80d" class="">Las auditor√≠as en SQL Server permiten registrar eventos y actividades dentro del servidor de base de datos. Son √∫tiles para monitorear seguridad, cumplimiento normativo y cambios en los datos.<br/><br/></p><h2 id="1bcbadfb-262d-8017-81a0-dc75b24aee42" class="">Auditor√≠a de servidor</h2><h3 id="1bcbadfb-262d-803f-a672-e87e2dbbb6c9" class="">Desde el interfaz gr√°fico:</h3><div id="1bcbadfb-262d-8072-9788-c6ede10b00ef" class="column-list"><div id="1bcbadfb-262d-8082-bb2f-ed150647abc5" style="width:50%" class="column"><figure id="1bcbadfb-262d-80ad-854b-f15f6cb1a2ce" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_11.06.34.png"><img style="width:337px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_11.06.34.png"/></a></figure></div><div id="1bcbadfb-262d-8061-8964-c943960a42b7" style="width:50%" class="column"><figure id="1bcbadfb-262d-8050-bf2e-e5fd89010143" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_11.08.21.png"><img style="width:513.484375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_11.08.21.png"/></a></figure></div></div><ul id="1bcbadfb-262d-8086-804a-e18d945ac6a9" class="bulleted-list"><li style="list-style-type:disc"><strong>Application log:</strong> La captura se env√≠a al visor de sucesos Aplications</li></ul><ul id="1bcbadfb-262d-801e-a7cb-cd3a96744ff4" class="bulleted-list"><li style="list-style-type:disc"><strong>Security log:</strong> La captura va a visor de sucesos Security</li></ul><ul id="1bcbadfb-262d-80fc-8e66-dda45d1b8b97" class="bulleted-list"><li style="list-style-type:disc"><strong>File:</strong> La captura va a un fichero</li></ul><h3 id="1bcbadfb-262d-8026-b377-d2404b5901af" class="">Desde el script</h3><p id="1bcbadfb-262d-80fa-bcb6-d899d97c8da9" class="">Siempre deben realizarse desde la base de datos master.</p><p id="1bcbadfb-262d-8025-b7f5-e553b042a24d" class="">Primero realizamos la auditor√≠a al appLog: </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-80c2-83c1-c2eb597f8803" class="code"><code class="language-SQL">USE MASTER 
GO

CREATE SERVER AUDIT [Auditoria_marzo20225]
	TO application_log
WITH
(queue_delay = 1000,
 on_failure = fail_operation
 )
 GO</code></pre><figure id="1bcbadfb-262d-80ba-9d78-dbaa8658bc8b" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_12.10.10.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_12.10.10.png"/></a></figure><p id="1bcbadfb-262d-80c2-ac8d-df47069ad236" class="">
</p><p id="1bcbadfb-262d-80f2-b9ae-c69b55214cd1" class="">Ahora la auditor√≠a al Security log:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-80c0-9074-cada476df2f3" class="code"><code class="language-SQL"> CREATE SERVER AUDIT [Security_Auditoria_marzo20225]
	TO security_log
WITH
(queue_delay = 1000,
 on_failure = fail_operation
 )
 GO</code></pre><figure id="1bcbadfb-262d-8057-9a50-f8c8141a2f5f" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_12.12.40.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_12.12.40.png"/></a></figure><p id="1bcbadfb-262d-808e-80f2-cafe02b8e8bd" class="">
</p><p id="1bcbadfb-262d-8099-9779-f0e6ef0e4d30" class="">Ahora vamos a realizar la auditor√≠a a archivo:</p><p id="1bcbadfb-262d-8067-bee8-cb024172c04f" class="">Primero creamos la carpeta donde se guardar√°:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-8016-8a2b-f1e1b4556f62" class="code"><code class="language-SQL"> EXEC sp_configure &#x27;show advanced options&#x27;, 1;
RECONFIGURE;

EXEC sp_configure &#x27;xp_cmdshell&#x27;, 1;
RECONFIGURE;

EXEC sp_configure &#x27;show advanced options&#x27;, 1;
RECONFIGURE;

EXEC xp_cmdshell &#x27;mkdir C:\auditorias&#x27;;</code></pre><p id="1bcbadfb-262d-807e-89d0-f36fcb1c8237" class="">Ahora generamos la auditor√≠a:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-8087-844e-dd32fed0da79" class="code"><code class="language-SQL">  CREATE SERVER AUDIT [File_Auditoria_marzo20225]
	TO FILE
(filepath = &#x27;c:\auditorias\&#x27;,
 maxsize = 0mb,
 max_rollover_files = 2147483647,
 reserve_disk_space = off
 )
 WITH(
	queue_delay = 1000,
	on_failure = continue
	)
GO</code></pre><figure id="1bcbadfb-262d-8004-acbe-d955e55afebd" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_12.14.28.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_12.14.28.png"/></a></figure><p id="1bcbadfb-262d-80e3-aabe-d1b9f11455c0" class="">Ahora tendr√≠amos las tres auditor√≠as creadas pero no estar√≠an activas, para activarlas podemos hacerlo mediante el entorno gr√°fico, pulsando con el boton derecho sobre la auditor√≠a o bien mediante el script:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-8022-8df6-d3d5c98a0f62" class="code"><code class="language-SQL">ALTER SERVER AUDIT File_Auditoria_marzo20225 WITH (STATE = ON)
GO</code></pre><p id="1bcbadfb-262d-8082-bad4-d31f50353f61" class="">Desaparece la X roja de la auditor√≠a en la barra lateral.</p><p id="1bcbadfb-262d-803a-9dd4-f5c2ed1df152" class="">Ahora nos queda darle las indicaciones de lo que queremos que audite, vamos a probar a hacerlo desde el script ya que desde el entorno gr√°fico es sencillo mediante boton derecho sobre la auditor√≠a. Vamos a pedirle que registre inicios de sesi√≥n fallidos, inicios de sesi√≥n exitosos y cambios de contrase√±a.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-80b0-b7c6-f8591c0e5f02" class="code"><code class="language-SQL">CREATE SERVER AUDIT SPECIFICATION [Specificaciones_Audit_File]
FOR SERVER AUDIT [File_Auditoria_marzo20225]
	ADD (FAILED_LOGIN_GROUP), 
	ADD (SUCCESSFUL_LOGIN_GROUP), 
	ADD (USER_CHANGE_PASSWORD_GROUP)  
GO</code></pre><p id="1bcbadfb-262d-805f-b760-c2173ad63488" class="">
</p><p id="1bcbadfb-262d-8001-be9c-f4a6551b0ea9" class="">Ahora haremos varias operaciones como cambiar de usuario, cambiar contrase√±as‚Ä¶etc y comprobamos que se registrasen los cambios en la auditor√≠a:</p><figure id="1bcbadfb-262d-80e0-9e1d-f5ab4d781a09" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_15.32.28.png"><img style="width:1074.984375px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_15.32.28.png"/></a></figure><blockquote id="1bcbadfb-262d-8003-9bce-c6779c883416" class=""><mark class="highlight-yellow_background">**No sabemos el motivo pero a pesar de que parece que todo est√° funcionando correctamente ya que al consultar mediante el script se muestran los registros, vemos que a trav√©s del entorno gr√°fico nos da un error y no se nos muestran. He mirado foros y consultado a distintas IA pero no he encontrado soluci√≥n.</mark></blockquote><p id="1bcbadfb-262d-804a-a175-f3925e82b54e" class="">
</p><h2 id="1bcbadfb-262d-80ec-91e5-ed99d38617b0" class="">Audiror√≠a de base de datos</h2><p id="1bcbadfb-262d-801b-9189-e1be15d4c7af" class="">Viene a ser practicamente lo mismo que la auditor√≠a de servidor pero a nivel base de datos, se usa el registro creado a nivel servidor y se implementa una especificaci√≥n a nivel base de datos. En este caso hemos probado a decirle que audite operaciones de lectura, escritura y borrado.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-8067-86c9-d52dd97b222c" class="code"><code class="language-SQL">CREATE DATABASE AUDIT SPECIFICATION [Auditor√≠a_Autoescuela_2025]
FOR SERVER AUDIT [File_auditoria_marzo2025]
ADD (SELECT ON OBJECT::[trabajadores] BY [dbo]),
ADD (INSERT ON OBJECT::[trabajadores] BY [dbo]),
ADD (DELETE ON OBJECT::[trabajadores] BY [dbo])
GO

SELECT * FROM trabajadores;
GO</code></pre><p id="1bcbadfb-262d-807b-ae75-f7b0b19bf3ac" class="">**Debemos acordarnos siempre de activar las especificaciones</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-8060-be9f-fbcb063bffe4" class="code"><code class="language-SQL">ALTER DATABASE AUDIT SPECIFICATION [Auditor√≠a_Autoescuela_2025] WITH (STATE = ON);
GO</code></pre><figure id="1bcbadfb-262d-8009-8ce1-d7d727b3fbac" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_16.28.49.png"><img style="width:1074.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-20_a_las_16.28.49.png"/></a></figure><p id="1bcbadfb-262d-8017-9300-ec5faead20ba" class="">
</p><h1 id="1bcbadfb-262d-805e-adac-f9fdb86de334" class="">3.- LEDGER</h1><p id="1bcbadfb-262d-8024-bdda-e5b498a20bfc" class="">LEDGER en SQL Server es una extensi√≥n de las bases de datos tradicionales que proporciona un registro inmutable de los datos. Permite a los usuarios verificar que los datos no han sido alterados ni manipulados desde su creaci√≥n.</p><p id="1bcbadfb-262d-80a2-91be-e5f6eb8398d6" class=""><strong>Tabla de Historial (History Table)</strong></p><p id="1bcbadfb-262d-80ae-9770-d7d26ffa22de" class="">Cada tabla LEDGER genera autom√°ticamente una tabla de historial, que guarda los registros anteriores cuando se realizan actualizaciones o eliminaciones.</p><p id="1bcbadfb-262d-803e-ac22-fd91d97bcb86" class=""><strong>Tabla de Ledger (Ledger Table)</strong></p><p id="1bcbadfb-262d-809b-8c9a-efa4cb98d5e3" class="">Es una tabla que almacena datos de forma inmutable. Existen dos tipos:</p><h2 id="1bcbadfb-262d-80c3-8aa1-caef8834f4af" class=""><strong>Updatable Ledger Table </strong></h2><p id="1bdbadfb-262d-8049-ad16-deffe296c181" class="">Permite operaciones <strong>INSERT, UPDATE y DELETE</strong>, pero mantiene un historial inmutable de los cambios.</p><p id="1bcbadfb-262d-80b9-957e-c4fe4a9366dc" class="">Creamos una tabla con ledger activo:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bcbadfb-262d-80ec-8448-f36fb570fdcd" class="code"><code class="language-SQL">CREATE TABLE [dbo].[pagos](
	[ID_pago] [int] IDENTITY(1,1) NOT NULL,
	[DNI_alumno] [varchar](9) NOT NULL,
	[Monto] [decimal](10, 2) NOT NULL,
	[Fecha_pago] [date] NOT NULL,
	[Tarjeta_credito] [varchar](25) NOT NULL,
	[Titular_tarjeta] [varchar](60) NOT NULL)
WITH
(
	SYSTEM_VERSIONING = ON (HISTORY_TABLE = dbo.PagosHistory),
	LEDGER = ON
);
	GO</code></pre><figure id="1bcbadfb-262d-80f3-a3ff-c8f70314c210" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_0.14.36.png"><img style="width:1186.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_0.14.36.png"/></a></figure><p id="1bcbadfb-262d-805a-a62e-efa0d355901e" class="">
</p><p id="1bcbadfb-262d-80b3-9b78-e97bd77ed89c" class="">Comprobamos los registros del ledger:</p><figure id="1bcbadfb-262d-8017-82f7-eafadc31d764" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_0.24.37.png"><img style="width:664px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_0.24.37.png"/></a></figure><p id="1bcbadfb-262d-80fd-9a8d-fcabf2602a3a" class="">
</p><p id="1bcbadfb-262d-802f-93c8-ed57de9fd04d" class="">Podemos obtener los registros del ledger a trav√©s de la vista:</p><figure id="1bcbadfb-262d-805e-884b-ef3844a31a9a" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_0.26.49.png"><img style="width:1186.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_0.26.49.png"/></a></figure><p id="1bcbadfb-262d-8065-9376-c46b7c204845" class="">
</p><p id="1bcbadfb-262d-802e-85ee-f560bea9ad26" class="">
</p><figure id="1bcbadfb-262d-800b-8b41-fc92d6b09292" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_0.43.31.png"><img style="width:1186.953125px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_0.43.31.png"/></a></figure><p id="1bcbadfb-262d-807d-af66-c2e9af8b769f" class="">
</p><p id="1bcbadfb-262d-8094-8555-f4512a66ee70" class="">Ahora realizamos varias operaciones en la tabla:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8008-8aef-f08837e80d67" class="code"><code class="language-SQL">INSERT INTO [dbo].[pagos] ([DNI_alumno], [Monto], [Fecha_pago], [Tarjeta_credito], [Titular_tarjeta])
VALUES 
(&#x27;12345678Z&#x27;, 60.00, &#x27;2024-01-15&#x27;, &#x27;5555 5555 1111 1111&#x27;, &#x27;Juana Mayol&#x27;);
GO

UPDATE pagos
	SET Tarjeta_credito = &#x27;5555 5555 1111 5555&#x27;
	WHERE DNI_alumno = &#x27;12345678Z&#x27;
GO

DELETE pagos
	WHERE DNI_alumno = &#x27;12345678Z&#x27;;
GO

DELETE pagos
	WHERE DNI_alumno = &#x27;23456789B&#x27;;
GO</code></pre><p id="1bcbadfb-262d-809e-bbee-d08b6608fe5f" class="">Consultamos la vista y comprobamos que aparecen las operaciones realizadas:</p><p id="1bdbadfb-262d-8048-a1c0-f2c2b189a1d5" class="">
</p><figure id="1bdbadfb-262d-8054-96f2-db7c44897d9b" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.05.02.png"><img style="width:1186.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.05.02.png"/></a></figure><p id="1bdbadfb-262d-808e-9d4f-cc34af5c6716" class="">
</p><h2 id="1bdbadfb-262d-80a6-859b-ea767fed6ace" class=""><strong>Append-only Ledger Table</strong> </h2><p id="1bdbadfb-262d-8042-a379-cc5ac84fefda" class="">Solo permite <strong>INSERT</strong>, evitando cambios o eliminaciones de datos.</p><p id="1bdbadfb-262d-80f7-9a5e-d8a0d610597e" class="">Creamos la tabla examen con APPEND-ONLY:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8092-94f0-e8545c9e5c63" class="code"><code class="language-SQL">CREATE TABLE [dbo].[examen](
	[ID_examen] [int] NOT NULL,
	[F_examen] [date] NULL,
	[Tipo_examen] [nvarchar](10) NULL,
	[Tipo_carnet] [nvarchar](10) NULL,
	[cliente_DNI_cliente] [varchar](9) NOT NULL,
	[vehiculo_vehiculo_ID] [numeric](28, 0) NOT NULL)
WITH
	(LEDGER = ON (APPEND_ONLY = ON));
GO</code></pre><figure id="1bdbadfb-262d-80c3-9732-f24ac95f6ced" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.28.57.png"><img style="width:1186.96875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.28.57.png"/></a></figure><p id="1bdbadfb-262d-802a-a27d-fedd15d502ee" class="">
</p><p id="1bdbadfb-262d-80dd-8f56-fe8e621087f1" class="">Ahora vemos como podemos insertar registros en la tabla pero no nos deja borrar ni actualizar registros:</p><div id="1bdbadfb-262d-80bc-a720-db2e0d9273ea" class="column-list"><div id="1bdbadfb-262d-803f-bcee-ed6bffaf9648" style="width:50%" class="column"><p id="1bdbadfb-262d-80b7-9f09-e43042170efa" class="">
</p><figure id="1bdbadfb-262d-80ab-8420-f862071752fe" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.32.35.png"><img style="width:624px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.32.35.png"/></a></figure></div><div id="1bdbadfb-262d-80d4-82f6-ff41892b287c" style="width:50%" class="column"><figure id="1bdbadfb-262d-80fb-a953-ecdb8196addf" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.32.50.png"><img style="width:569.46875px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.32.50.png"/></a></figure></div></div><p id="1bdbadfb-262d-8002-a740-f409d14c6ec0" class="">
</p><figure id="1bdbadfb-262d-80a3-a451-e60349001655" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.34.56.png"><img style="width:623px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_1.34.56.png"/></a></figure><p id="1bdbadfb-262d-8067-bac2-f31ed63f2654" class="">
</p><p id="1bdbadfb-262d-8036-9567-f56ba04bd5e8" class="">
</p><h2 id="1bdbadfb-262d-80ed-bc82-dc3ba9905737" class="">Prueba detecci√≥n de modificaciones</h2><p id="1bdbadfb-262d-80b9-8fe4-f58be6f1ecc4" class=""><mark class="highlight-orange"><strong>sys.database_ledger_blocks</strong></mark></p><p id="1bdbadfb-262d-80f0-84d6-f45147430821" class="">Es una vista del sistema en SQL Server que almacena el historial de los bloques de auditor√≠a (Ledger Blocks) en una base de datos con Ledger activado.<br/>Cada bloque representa un conjunto de transacciones registradas en las tablas ledger para garantizar la inmutabilidad y la integridad de los datos.<br/></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8092-bbe0-fa9dd6ad380e" class="code"><code class="language-SQL">SELECT * FROM sys.database_ledger_blocks
go</code></pre><figure id="1bdbadfb-262d-8052-8d2c-ebd4d0c3aa05" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_13.32.00.png"><img style="width:768px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_13.32.00.png"/></a></figure><p id="1bdbadfb-262d-809a-b7d9-d7583cd0507b" class="">
</p><p id="1bdbadfb-262d-8056-b1f2-e8b78650a1e9" class=""><mark class="highlight-orange"><strong>sp_generate_database_ledger_digest</strong></mark></p><p id="1bdbadfb-262d-803b-9c4e-c844d434225d" class="">El Ledger Digest es un resumen criptogr√°fico (hash) de los datos almacenados en las tablas ledger de SQL Server. Se usa para garantizar la integridad y la inmutabilidad de los datos en una base de datos con Ledger activado.</p><p id="1bdbadfb-262d-8010-9998-fcb2b8735f59" class="">Generamos el ledger digest :</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8034-8223-c1315ceeecad" class="code"><code class="language-SQL">EXECUTE sp_generate_database_ledger_digest
go</code></pre><p id="1bdbadfb-262d-806a-9ad1-c9a921522557" class="">Nos da como resultado:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8082-ae74-d48b799ada17" class="code"><code class="language-SQL">{&quot;database_name&quot;:&quot;AutoescuelaP&quot;,&quot;block_id&quot;:0,&quot;hash&quot;:&quot;0xCE4736A4A458A617ACADE243D1BF35539A32FA8853A62F5F3CEC62FCA4A9089A&quot;,&quot;last_transaction_commit_time&quot;:&quot;2025-03-21T01:32:13.8433333&quot;,&quot;digest_time&quot;:&quot;2025-03-21T12:25:27.7360992&quot;}</code></pre><p id="1bdbadfb-262d-8017-a768-d7d3b7d99e75" class="">
</p><p id="1bdbadfb-262d-8093-ae03-e11c69b082ee" class=""><mark class="highlight-orange"><strong>SET ALLOW_SNAPSHOT_ISOLATION ON</strong></mark></p><p id="1bdbadfb-262d-80f3-a598-d14836d6926f" class="">La Snapshot Isolation es un nivel de aislamiento en SQL Server que <strong>evita bloqueos de lectura</strong> y permite que las consultas lean datos consistentes sin ser afectadas por transacciones concurrentes.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-80d9-b93e-dc402daffbd3" class="code"><code class="language-SQL">
ALTER DATABASE AutoescuelaP
	SET ALLOW_SNAPSHOT_ISOLATION ON;
GO</code></pre><p id="1bdbadfb-262d-80ed-9860-cf1c3dccd2b6" class="">
</p><p id="1bdbadfb-262d-8086-8789-dac7d535218b" class=""><mark class="highlight-orange"><strong>sp_verify_database_ledger</strong></mark></p><p id="1bdbadfb-262d-803e-8008-eceba687a14e" class="">Verifica la integridad del historial de transacciones en la tabla dentro de la base de datos, usando los valores de ledger digest proporcionados.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8026-9292-ca2e3a633231" class="code"><code class="language-SQL">EXECUTE sp_verify_database_ledger N&#x27;
[{&quot;database_name&quot;:&quot;AutoescuelaP&quot;,&quot;block_id&quot;:0,&quot;hash&quot;:&quot;0xCE4736A4A458A617ACADE243D1BF35539A32FA8853A62F5F3CEC62FCA4A9089A&quot;,&quot;last_transaction_commit_time&quot;:&quot;2025-03-21T01:32:13.8433333&quot;,&quot;digest_time&quot;:&quot;2025-03-21T12:25:27.7360992&quot;}
]&#x27;;
GO  </code></pre><p id="1bdbadfb-262d-80bd-a94b-db3caafa1db7" class="">
</p><p id="1bdbadfb-262d-8036-8ce0-ed82fb3c59c3" class=""><mark class="highlight-orange"><strong>sys.fn_PhysLocFormatter(%%physloc%%)</strong></mark></p><p id="1bdbadfb-262d-8090-b914-dd5288d8e39b" class="">Devuelve  la direcci√≥n de almacenamiento de cada fila con el formato: (File:Page:Slot)<div class="indented"><ul id="1bdbadfb-262d-809c-ba94-f8da714c4144" class="bulleted-list"><li style="list-style-type:disc">File: N√∫mero del archivo de datos donde se almacena la fila.</li></ul><ul id="1bdbadfb-262d-800f-9bd6-d4feb3d8ad14" class="bulleted-list"><li style="list-style-type:disc">Page: N√∫mero de la p√°gina dentro del archivo.</li></ul><ul id="1bdbadfb-262d-80e0-b3fa-e2dc49617ab4" class="bulleted-list"><li style="list-style-type:disc">Slot: Posici√≥n de la fila dentro de la p√°gina.</li></ul></div></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-80f8-ac13-e8a909abfa0b" class="code"><code class="language-SQL">SELECT sys.fn_PhysLocFormatter(%%physloc%%) as [Physical RID], * 
FROM dbo.pagos
go</code></pre><figure id="1bdbadfb-262d-8019-86c9-c34de16faa87" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_15.25.06.png"><img style="width:624px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_15.25.06.png"/></a></figure><p id="1bdbadfb-262d-80e2-a378-df833f4951ab" class="">Podemos solicitar que nos devuelva una posici√≥n de una fila en concreto filtrando por el ID, en este caso vamos a pedir que nos muestre en que direcci√≥n se encuentra almacenado el registro 5, que es el que queremos modificar para ver si el ledger detecta la intrusi√≥n, por ejemplo:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8096-9834-e4a5058f77b3" class="code"><code class="language-SQL">SELECT sys.fn_PhysLocFormatter(%%physloc%%) as [Physical RID], * 
FROM dbo.pagos 
WHERE ID_pago = 5;
GO</code></pre><figure id="1bdbadfb-262d-80ef-b5e7-f060477c6ded" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_15.30.58.png"><img style="width:628px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_15.30.58.png"/></a></figure><p id="1bdbadfb-262d-8041-a984-ef0d546cf3b7" class="">
</p><p id="1bdbadfb-262d-80de-b707-cd5fe142443b" class=""><mark class="highlight-orange">DBCC TRACEON(3604)</mark></p><p id="1bdbadfb-262d-803f-afce-f477bd55bd6f" class="">Activa una traza espec√≠fica (Trace Flag 3604), que redirige la salida de ciertos comandos de depuraci√≥n a la ventana de resultados en SSMS en lugar de almacenarla internamente. Cuando ejecutas comandos de diagn√≥stico como DBCC PAGE o DBCC IND, SQL Server no muestra los resultados por defecto. Activar TRACEON(3604) permite que se impriman en la consola de SSMS. </p><p id="1bdbadfb-262d-80c7-ab40-ccbeca175f4b" class="">Vamos a pedir que se nos muestre lo que contiene la p√°gina del registro que queremos modificar:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-80db-875f-e720916cf71a" class="code"><code class="language-SQL">DBCC TRACEON(3604)
GO
DBCC PAGE(AutoescuelaP, 1, 1344, 3) -- Muestra la estructura de la p√°gina 2500
GO
</code></pre><figure id="1bdbadfb-262d-8037-b562-e64b1d562a26" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_15.33.24.png"><img style="width:816px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_15.33.24.png"/></a></figure><p id="1bdbadfb-262d-8090-ab7d-e06a33d272b2" class="">
</p><figure id="1bdbadfb-262d-8088-b7e2-ef0cdd4679fb" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_15.49.09.png"><img style="width:623px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_15.49.09.png"/></a></figure><p id="1bdbadfb-262d-800e-a4fc-f042575fa089" class="">
</p><p id="1bdbadfb-262d-80c4-ad9f-c952010bd48e" class="">Ahora vamos a convertir a VARBINARY los n√∫meros de las tarjetas, tanto la buena como la pirateada:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-800e-a468-dfd79dc01773" class="code"><code class="language-SQL">SELECT CONVERT (VARBINARY(33),&#x27;6011 0000 0000 0004&#x27;) -- Conversi√≥n de tarjeta buena
GO
-- 0x36303131203030303020303030302030303034


SELECT CONVERT (VARBINARY(33),&#x27;6666 6666 6666 6666&#x27;) -- Conversi√≥n de tarjeta pirateada
GO
-- 0x36363636203636363620363636362036363636</code></pre><p id="1bdbadfb-262d-80e7-94f4-d0803620359c" class="">
</p><p id="1bdbadfb-262d-8031-aa2a-c158006843f4" class="">Ahora viene la parte en la que ‚Äúcorrompemos‚Äù los datos de la base de datos y que pretendemos detectar con el ledger. Para ello, primero vamos a desactivar la verificaci√≥n de p√°ginas:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8039-bda9-c334671b1019" class="code"><code class="language-SQL">ALTER DATABASE AutoescuelaP SET PAGE_VERIFY NONE
GO</code></pre><p id="1bdbadfb-262d-8070-a394-fc14ffed391c" class="">Cambiamos la base de datos a modo monousuario:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-80b9-acbb-d8288cd43f27" class="code"><code class="language-SQL">ALTER DATABASE AutoescuelaP SET SINGLE_USER
GO</code></pre><p id="1bdbadfb-262d-802f-baec-e96444b7cf03" class="">Ahora reescribimos lo que queremos en la p√°gina:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-8075-9614-d3874c868e2f" class="code"><code class="language-SQL">DBCC WRITEPAGE (&#x27;AutoescuelaP&#x27;,1,544,104,33,0x36363636203636363620363636362036363636,0)
GO</code></pre><p id="1bdbadfb-262d-8045-8399-d50542cc2c40" class="">Ahora volvemos a poner la base de datos en multiusuario y activamos el control de p√°gina:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-80fd-b331-cbe76db194e0" class="code"><code class="language-SQL">ALTER DATABASE AutoescuelaP SET MULTI_USER
GO
ALTER DATABASE AutoescuelaP SET PAGE_VERIFY CHECKSUM
GO</code></pre><p id="1bdbadfb-262d-8051-86c6-c4964ecc6cb5" class="">Al realiar una consulta nos damos cuenta que hemos cometido un error al introducir el comando para modificar la tarjeta:</p><figure id="1bdbadfb-262d-8050-ae5c-d2a7aa0dc568" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_16.06.49.png"><img style="width:634px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_16.06.49.png"/></a></figure><p id="1bdbadfb-262d-8047-964e-d9ea18d7d145" class="">
</p><p id="1bdbadfb-262d-8033-b71e-fd96aea7e9ae" class="">El error estaba en que hab√≠amos introducido mal el offset de la sentencia de modificaci√≥n, ahora si vemos la tarjeta modificada:</p><figure id="1bdbadfb-262d-807d-a5cb-d5885722a588" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_16.24.02.png"><img style="width:599px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_16.24.02.png"/></a></figure><p id="1bdbadfb-262d-80d4-8921-dbf6018ebe69" class="">
</p><p id="1bdbadfb-262d-8092-be20-c01a95b5de81" class="">Ahora al comprobar la integridad de la base de datos con ledger, nos dice que el hash asociado no coincide con el hash actual y por tanto la base de datos est√° corrupta o modificada.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1bdbadfb-262d-805a-957d-e08106f86094" class="code"><code class="language-SQL">EXECUTE sp_verify_database_ledger N&#x27;
[{&quot;database_name&quot;:&quot;AutoescuelaP&quot;,&quot;block_id&quot;:0,&quot;hash&quot;:&quot;0xCE4736A4A458A617ACADE243D1BF35539A32FA8853A62F5F3CEC62FCA4A9089A&quot;,&quot;last_transaction_commit_time&quot;:&quot;2025-03-21T01:32:13.8433333&quot;,&quot;digest_time&quot;:&quot;2025-03-21T12:25:27.7360992&quot;}
]&#x27;;
GO  </code></pre><figure id="1bdbadfb-262d-800e-8c0d-e1e605c59626" class="image"><a href="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_16.30.21.png"><img style="width:1186.90625px" src="Tarea%204%20SEGURIDAD%20196badfb262d8072bd4ce965b22ab414/Captura_de_pantalla_2025-03-21_a_las_16.30.21.png"/></a></figure><p id="1bdbadfb-262d-8067-8192-c9a74c8132ba" class="">
</p><p id="1bdbadfb-262d-8061-ad5b-c1cffa020346" class="">
</p><p id="1bdbadfb-262d-8097-b51a-c49155dfbc8c" class="">
</p><p id="1bdbadfb-262d-8031-85f2-e8a83e0b738f" class="">
</p><p id="1bdbadfb-262d-80e8-851a-c067d3f96aee" class="">
</p><p id="1bdbadfb-262d-8058-8812-e8005f551b24" class=""> </p><p id="1bdbadfb-262d-8078-986e-f919da9730de" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>